<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.5f81339daa9828444137.css">@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:100;src:local("Montserrat Thin "),local("Montserrat-Thin"),url(/static/montserrat-latin-100-191cc9f50f3b76b9617cb383f19acb7d.woff2) format("woff2"),url(/static/montserrat-latin-100-370318464551d5f25b0f0a78f374faac.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:100;src:local("Montserrat Thin italic"),local("Montserrat-Thinitalic"),url(/static/montserrat-latin-100italic-bdeaeb79db315697bd173a55b097dc18.woff2) format("woff2"),url(/static/montserrat-latin-100italic-ecf7d49386e8f265878e735db34a7c4b.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:200;src:local("Montserrat Extra Light "),local("Montserrat-Extra Light"),url(/static/montserrat-latin-200-85d5ef9db7f2dc6979172a4a3b2c57cb.woff2) format("woff2"),url(/static/montserrat-latin-200-1fc98e126a3d152549240e6244d7e669.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:200;src:local("Montserrat Extra Light italic"),local("Montserrat-Extra Lightitalic"),url(/static/montserrat-latin-200italic-49095760a498d024fe1a85a078850df9.woff2) format("woff2"),url(/static/montserrat-latin-200italic-fe46cf8b9462c820457d3bf537e4057f.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:300;src:local("Montserrat Light "),local("Montserrat-Light"),url(/static/montserrat-latin-300-7c3daf12b706645b5d3710f863a4da04.woff2) format("woff2"),url(/static/montserrat-latin-300-8dc95fab9cf98d02ca8d76e97d3dff60.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:300;src:local("Montserrat Light italic"),local("Montserrat-Lightitalic"),url(/static/montserrat-latin-300italic-f20b178ca2024a5eac8e42e6649db86c.woff2) format("woff2"),url(/static/montserrat-latin-300italic-3fe16939288856e8e828fa2661bf2354.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:400;src:local("Montserrat Regular "),local("Montserrat-Regular"),url(/static/montserrat-latin-400-bc3aa95dca08f5fee5291e34959c27bc.woff2) format("woff2"),url(/static/montserrat-latin-400-8102c4838f9e3d08dad644290a9cb701.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:400;src:local("Montserrat Regular italic"),local("Montserrat-Regularitalic"),url(/static/montserrat-latin-400italic-5cad650422a7184467af5a4d17b264c4.woff2) format("woff2"),url(/static/montserrat-latin-400italic-d191f22af3bb50902b99ac577f81a322.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:500;src:local("Montserrat Medium "),local("Montserrat-Medium"),url(/static/montserrat-latin-500-92d16e458625f4d2c8940f6bdca0ff09.woff2) format("woff2"),url(/static/montserrat-latin-500-8b763220218ffc11c57c84ddb80e7b26.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:500;src:local("Montserrat Medium italic"),local("Montserrat-Mediumitalic"),url(/static/montserrat-latin-500italic-47bfcca6b69d6a9acca7a8bff17193e2.woff2) format("woff2"),url(/static/montserrat-latin-500italic-72c01f753c3940c0b9cb6bf2389caddf.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:600;src:local("Montserrat SemiBold "),local("Montserrat-SemiBold"),url(/static/montserrat-latin-600-6fb1b5623e528e27c18658fecf5ee0ee.woff2) format("woff2"),url(/static/montserrat-latin-600-7c839d15a6f54e7025ba8c0c4b333e8f.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:600;src:local("Montserrat SemiBold italic"),local("Montserrat-SemiBolditalic"),url(/static/montserrat-latin-600italic-60789af1c9338ed1a9546722ec54b4f7.woff2) format("woff2"),url(/static/montserrat-latin-600italic-f3d4de8d0afb19e777c79032ce828e3d.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:700;src:local("Montserrat Bold "),local("Montserrat-Bold"),url(/static/montserrat-latin-700-39d93cf678c740f9f6b2b1cfde34bee3.woff2) format("woff2"),url(/static/montserrat-latin-700-80f10bd382f0df1cd650fec59f3c9394.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:700;src:local("Montserrat Bold italic"),local("Montserrat-Bolditalic"),url(/static/montserrat-latin-700italic-ba136d97b14e82284dd595e257f11c47.woff2) format("woff2"),url(/static/montserrat-latin-700italic-8c98142b425630821139c24bd1698700.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold "),local("Montserrat-ExtraBold"),url(/static/montserrat-latin-800-b7018be9ed6cd94da8b6675b3a468c3b.woff2) format("woff2"),url(/static/montserrat-latin-800-9a9befcf50d64f9d2d19d8b1d1984add.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:800;src:local("Montserrat ExtraBold italic"),local("Montserrat-ExtraBolditalic"),url(/static/montserrat-latin-800italic-540ffdd223d1a9ad3d4e678e1a23372e.woff2) format("woff2"),url(/static/montserrat-latin-800italic-897086f99f4e1f45e6b1e9368527d0bc.woff) format("woff")}@font-face{font-family:Montserrat;font-style:normal;font-display:swap;font-weight:900;src:local("Montserrat Black "),local("Montserrat-Black"),url(/static/montserrat-latin-900-58cd789700850375b834e8b6776002eb.woff2) format("woff2"),url(/static/montserrat-latin-900-26d42c9428780e545a540bbb50c84bce.woff) format("woff")}@font-face{font-family:Montserrat;font-style:italic;font-display:swap;font-weight:900;src:local("Montserrat Black italic"),local("Montserrat-Blackitalic"),url(/static/montserrat-latin-900italic-451157bc8861fe54f523b3669a3def71.woff2) format("woff2"),url(/static/montserrat-latin-900italic-a8ec4957e1c24f5793305763ad9845b3.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:300;src:local("Merriweather Light "),local("Merriweather-Light"),url(/static/merriweather-latin-300-b1158cfcd4aacb9d8fb61625e37af46a.woff2) format("woff2"),url(/static/merriweather-latin-300-cc7de05e166e90320d7d896e0f72a19d.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:300;src:local("Merriweather Light italic"),local("Merriweather-Lightitalic"),url(/static/merriweather-latin-300italic-8fe52a48089d6ebe46db0b8e7cc66263.woff2) format("woff2"),url(/static/merriweather-latin-300italic-e1331f5397c2a673f9d3765138debdb5.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:400;src:local("Merriweather Regular "),local("Merriweather-Regular"),url(/static/merriweather-latin-400-8276fdb72ae8f4714d4e6eba704cc39f.woff2) format("woff2"),url(/static/merriweather-latin-400-69f09800f4f6479d06e44eba837df872.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:400;src:local("Merriweather Regular italic"),local("Merriweather-Regularitalic"),url(/static/merriweather-latin-400italic-3a9be9ea9f7aa4af6de7307df21d9fc0.woff2) format("woff2"),url(/static/merriweather-latin-400italic-d76079ed7541a433a54f79316de086e9.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:700;src:local("Merriweather Bold "),local("Merriweather-Bold"),url(/static/merriweather-latin-700-fa534be7ffa380e39a7f6e03bf9a5e03.woff2) format("woff2"),url(/static/merriweather-latin-700-ba56ea84b8084b7ff9677f50d3cd81bd.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:700;src:local("Merriweather Bold italic"),local("Merriweather-Bolditalic"),url(/static/merriweather-latin-700italic-1ef5edaaa20ae53ea50399884c5e48c6.woff2) format("woff2"),url(/static/merriweather-latin-700italic-534bc9e7ce93c73d73426e46acd78092.woff) format("woff")}@font-face{font-family:Merriweather;font-style:normal;font-display:swap;font-weight:900;src:local("Merriweather Black "),local("Merriweather-Black"),url(/static/merriweather-latin-900-7528fb70e8a4a82c7305e72ff43ac25f.woff2) format("woff2"),url(/static/merriweather-latin-900-3799b6e2f5ed3fcccf9d7a708d7419fa.woff) format("woff")}@font-face{font-family:Merriweather;font-style:italic;font-display:swap;font-weight:900;src:local("Merriweather Black italic"),local("Merriweather-Blackitalic"),url(/static/merriweather-latin-900italic-e1b4d2aaa78e12ad84aaf8a56321e4c2.woff2) format("woff2"),url(/static/merriweather-latin-900italic-2ae22f731b3424e8dbb4b37f7ca6e708.woff) format("woff")}</style><meta name="generator" content="Gatsby 2.19.1"/><title data-react-helmet="true">Build your own React</title><meta data-react-helmet="true" name="description" content="We are going to rewrite React from scratch. Step by step. Following the architecture from the real React code but without all the…"/><meta data-react-helmet="true" name="image" content="https://pomb.us/static/b4694e6041953e3cb16f6a889f0cbc59/54290/card.png"/><meta data-react-helmet="true" property="og:url" content="https://pomb.us/"/><meta data-react-helmet="true" property="og:type" content="article"/><meta data-react-helmet="true" property="og:title" content="Build your own React"/><meta data-react-helmet="true" property="og:description" content="We are going to rewrite React from scratch. Step by step. Following the architecture from the real React code but without all the…"/><meta data-react-helmet="true" property="og:image" content="https://pomb.us/static/b4694e6041953e3cb16f6a889f0cbc59/54290/card.png"/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/><meta data-react-helmet="true" name="twitter:creator" content="@pomber"/><meta data-react-helmet="true" name="twitter:title" content="Build your own React"/><meta data-react-helmet="true" name="twitter:description" content="We are going to rewrite React from scratch. Step by step. Following the architecture from the real React code but without all the…"/><meta data-react-helmet="true" name="twitter:image" content="https://pomb.us/static/b4694e6041953e3cb16f6a889f0cbc59/54290/card.png"/><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><link as="script" rel="preload" href="/webpack-runtime-73554bd2e193becfd1eb.js"/><link as="script" rel="preload" href="/styles-47650936bd9d421e990d.js"/><link as="script" rel="preload" href="/app-3a9f397a1682eeb031a5.js"/><link as="script" rel="preload" href="/commons-905574fadf973c38b312.js"/><link as="script" rel="preload" href="/component---src-templates-post-js-914a311e412eac3f8658.js"/><link as="fetch" rel="preload" href="/page-data/build-your-own-react/page-data.json" crossorigin="anonymous"/></head><body><script>(function() { try {
        var mode = localStorage.getItem('theme-ui-color-mode');
        if (!mode) return
        document.body.classList.add('theme-ui-' + mode);
      } catch (e) {} })();</script><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group" id="gatsby-focus-wrapper"><style data-emotion-css="3f901z">.css-3f901z{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;width:100vw;}</style><style data-emotion-css="wpumvr">.css-wpumvr{font-family:'Merriweather','Georgia',serif;font-size:16px;font-weight:400;line-height:1.75;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;width:100vw;}</style><div class="css-wpumvr"><style data-emotion-css="mmvxbu">body{margin:0;overflow-x:hidden;}</style><style data-emotion-css="1k8spbk">.css-1k8spbk{background-color:var(--theme-ui-colors-darkBackground,#202226);color:var(--theme-ui-colors-lightText,#DFDDD9);width:0;min-height:100vh;}@media screen and (min-width:1000px){.css-1k8spbk{width:50%;}}</style><aside class="css-1k8spbk"></aside><style data-emotion-css="1cnubwf">.css-1cnubwf{background-color:var(--theme-ui-colors-background,#FAF9F5);color:var(--theme-ui-colors-text,rgb(51,51,51));width:100%;}@media screen and (min-width:1000px){.css-1cnubwf{width:50%;}}</style><div class="css-1cnubwf"><style data-emotion-css="1exbnt5">.css-1exbnt5{padding-top:112px;padding-bottom:112px;padding-left:0;width:420px;max-width:80%;margin-left:auto;margin-right:auto;}@media screen and (min-width:1000px){.css-1exbnt5{padding-top:256px;padding-bottom:256px;padding-left:85px;width:420px;max-width:none;margin-left:0;margin-right:0;}}</style><main class="css-1exbnt5"><main><style data-emotion-css="79elbk">.css-79elbk{position:relative;}</style><div class="css-79elbk"><style data-emotion-css="16sttew">.css-16sttew{position:static;width:100%;height:auto;right:auto;color:var(--theme-ui-colors-text,rgb(51,51,51));}@media screen and (min-width:1000px){.css-16sttew{position:absolute;height:100%;right:590px;color:var(--theme-ui-colors-lightText,#DFDDD9);}}</style><aside class="css-16sttew"><style data-emotion-css="m1yyna">.css-m1yyna{float:none;display:block;text-align:left;}@media screen and (min-width:1000px){.css-m1yyna{float:right;display:inline-block;text-align:right;}}</style><div class="css-m1yyna"><style data-emotion-css="n19ytf">.css-n19ytf{padding-top:7px;}</style><style data-emotion-css="1jyic8i">.css-1jyic8i{padding:0;margin:0;margin-bottom:28px;padding-top:7px;}.css-1jyic8i code{font-size:inherit;}</style><p class="css-1jyic8i"><style data-emotion-css="1bh1wmd">.css-1bh1wmd{-webkit-text-decoration:none;text-decoration:none;color:inherit;border:none;}</style><style data-emotion-css="gtrh26">.css-gtrh26{color:inherit;-webkit-text-decoration:none;text-decoration:none;border-bottom:1px solid;border-color:var(--theme-ui-colors-muted,rgba(175,173,169,0.5));-webkit-text-decoration:none;text-decoration:none;color:inherit;border:none;}</style><a href="/" class="css-gtrh26">Rodrigo Pombo</a><br/><style data-emotion-css="cz7783">.css-cz7783{font-size:13.32085131842997px;}</style><span class="css-cz7783">November 13, 2019</span></p></div></aside><div><style data-emotion-css="c18jar">.css-c18jar{padding-bottom:80px;}</style><style data-emotion-css="17fq4g6">.css-17fq4g6{padding:0;margin:0;margin-bottom:28px;font-size:40px;font-family:Montserrat,sans-serif;line-height:1.1;font-weight:900;padding-bottom:80px;}</style><h1 class="css-17fq4g6">Build your own React</h1></div></div><style data-emotion-css="1mv7wyt">.css-1mv7wyt{padding:0;margin:0;margin-bottom:28px;}.css-1mv7wyt code{font-size:inherit;}</style><p class="css-1mv7wyt">We are going to rewrite React from scratch. Step by step. Following the architecture from the real React code but without all the optimizations and non-essential features.</p><p class="css-1mv7wyt">If you’ve read any of <style data-emotion-css="1scict0">.css-1scict0{color:inherit;-webkit-text-decoration:none;text-decoration:none;border-bottom:1px solid;border-color:var(--theme-ui-colors-muted,rgba(175,173,169,0.5));}</style><a href="https://engineering.hexacta.com/didact-learning-how-react-works-by-building-it-from-scratch-51007984e5c5" class="css-1scict0">my previous “build your own React” posts</a>, the difference is that this post is based on React 16.8, so we can now use hooks and drop all the code related to classes.</p><p class="css-1mv7wyt">You can find the history with the old blog posts and the code on the <a href="https://github.com/pomber/didact" class="css-1scict0">Didact repo</a>. There’s also a <a href="https://youtu.be/8Kc2REHdwnQ" class="css-1scict0">talk covering the same content</a>. But this is a self-contained post. </p><p class="css-1mv7wyt">Starting from scratch, these are all the things we’ll add to our version of React one by one:</p><style data-emotion-css="wf0k3i">.css-wf0k3i{padding:0;margin:0;margin-bottom:28px;list-style-position:outside;list-style-image:none;margin-left:28px;}</style><ul class="css-wf0k3i"><style data-emotion-css="16s26jd">.css-16s26jd{margin-bottom:4px;padding-left:0;}.css-16s26jd ol{margin-top:14px;margin-bottom:14px;margin-left:28px;}.css-16s26jd ul{margin-top:14px;margin-bottom:14px;margin-left:28px;}.css-16s26jd p{margin-bottom:14px;}.css-16s26jd code{font-size:inherit;}</style><li class="css-16s26jd"><style data-emotion-css="1vg6q84">.css-1vg6q84{font-weight:700;}</style><strong class="css-1vg6q84">Step I</strong>: The <style data-emotion-css="iofpht">.css-iofpht{border-radius:0.3em;padding-top:0.15em;padding-bottom:0.05em;padding-left:0.2em;padding-right:0.2em;}</style><code class="css-iofpht">createElement</code> Function</li><li class="css-16s26jd"><strong class="css-1vg6q84">Step II</strong>: The <code class="css-iofpht">render</code> Function</li><li class="css-16s26jd"><strong class="css-1vg6q84">Step III</strong>: Concurrent Mode</li><li class="css-16s26jd"><strong class="css-1vg6q84">Step IV</strong>: Fibers</li><li class="css-16s26jd"><strong class="css-1vg6q84">Step V</strong>: Render and Commit Phases</li><li class="css-16s26jd"><strong class="css-1vg6q84">Step VI</strong>: Reconciliation</li><li class="css-16s26jd"><strong class="css-1vg6q84">Step VII</strong>: Function Components</li><li class="css-16s26jd"><strong class="css-1vg6q84">Step VIII</strong>: Hooks</li></ul><style data-emotion-css="1iq4mep">.css-1iq4mep{width:100%;margin-left:0;margin-bottom:28px;position:relative;display:block;}@media screen and (min-width:1000px){.css-1iq4mep{width:1010px;margin-left:-590px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}}</style><div class="css-1iq4mep"><style data-emotion-css="ovklbk">.css-ovklbk{width:100vw;margin-left:calc(50% - 50vw);position:-webkit-sticky;position:sticky;top:0;z-index:1;height:50vh;padding-right:0;}@media screen and (min-width:1000px){.css-ovklbk{width:420px;margin-left:0;position:static;top:auto;z-index:auto;height:auto;padding-right:85px;}}</style><div class="css-ovklbk"><div style="height:100%;width:100%"><style data-emotion-css="7yj60q">.css-7yj60q{position:static;width:100%;height:100%;max-height:100%;top:auto;}@media screen and (min-width:1000px){.css-7yj60q{position:-webkit-sticky;position:sticky;height:60vh;max-height:60vh;top:20vh;}}</style><div class="css-7yj60q"><div style="overflow:auto;height:100%;width:100%"><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><style data-emotion-css="lx95p3">.css-lx95p3{color:var(--theme-ui-colors-lightText,#DFDDD9);background-color:var(--theme-ui-colors-darkBackground,#202226);}.css-lx95p3 .token-comment,.css-lx95p3 .token-cdata,.css-lx95p3 .token-doctype{font-style:italic;}.css-lx95p3 .token-builtin,.css-lx95p3 .token-changed,.css-lx95p3 .token-keyword,.css-lx95p3 .token-punctuation,.css-lx95p3 .token-operator,.css-lx95p3 .token-tag,.css-lx95p3 .token-deleted,.css-lx95p3 .token-string,.css-lx95p3 .token-attr-value,.css-lx95p3 .token-char,.css-lx95p3 .token-number,.css-lx95p3 .token-inserted{color:#aaf6d9;}</style><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><style data-emotion-css="1i8e78v">.css-1i8e78v{color:var(--theme-ui-colors-lightText,#DFDDD9);background-color:var(--theme-ui-colors-darkBackground,#202226);}</style><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;transform:translateX(250px);height:0;opacity:0"><div style="display:inline-block" class="cs-line cs-line-6"><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-13"><span class="token-keyword">const</span><span class="token-plain"> element </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-punctuation">&lt;</span><span class="token-tag">h1</span><span class="token-tag"> </span><span class="token-attr-name">title</span><span class="token-punctuation">=</span><span class="token-punctuation">&quot;</span><span class="token-attr-value">foo</span><span class="token-punctuation">&quot;</span><span class="token-punctuation">&gt;</span><span class="token-plain">Hello</span><span class="token-punctuation">&lt;/</span><span class="token-tag">h1</span><span class="token-punctuation">&gt;</span></div></div><div style="overflow:hidden"><div style="display:inline-block" class="cs-line cs-line-14"><span class="token-keyword">const</span><span class="token-plain"> container </span><span class="token-operator">=</span><span class="token-plain"> document</span><span class="token-punctuation">.</span><span class="token-function">getElementById</span><span class="token-punctuation">(</span><span class="token-string">&quot;root&quot;</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-24"><span class="token-plain">ReactDOM</span><span class="token-punctuation">.</span><span class="token-function">render</span><span class="token-punctuation">(</span><span class="token-plain">element</span><span class="token-punctuation">,</span><span class="token-plain"> container</span><span class="token-punctuation">)</span></div></div><div></div></code></pre></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-6"><span class="token-punctuation">}</span></div></div><div style="overflow:hidden"><div style="display:inline-block" class="cs-line cs-line-14"><span class="token-keyword">const</span><span class="token-plain"> container </span><span class="token-operator">=</span><span class="token-plain"> document</span><span class="token-punctuation">.</span><span class="token-function">getElementById</span><span class="token-punctuation">(</span><span class="token-string">&quot;root&quot;</span><span class="token-punctuation">)</span></div></div><div></div></code></pre></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-6"><span class="token-punctuation">}</span></div></div><div style="overflow:hidden"><div style="display:inline-block" class="cs-line cs-line-14"><span class="token-keyword">const</span><span class="token-plain"> container </span><span class="token-operator">=</span><span class="token-plain"> document</span><span class="token-punctuation">.</span><span class="token-function">getElementById</span><span class="token-punctuation">(</span><span class="token-string">&quot;root&quot;</span><span class="token-punctuation">)</span></div></div><div></div></code></pre></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-6"><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;opacity:1"><div style="display:inline-block" class="cs-line cs-line-14"><span class="token-keyword">const</span><span class="token-plain"> container </span><span class="token-operator">=</span><span class="token-plain"> document</span><span class="token-punctuation">.</span><span class="token-function">getElementById</span><span class="token-punctuation">(</span><span class="token-string">&quot;root&quot;</span><span class="token-punctuation">)</span></div></div><div></div></code></pre></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:1"><div style="display:inline-block" class="cs-line cs-line-6"><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-14"><span class="token-keyword">const</span><span class="token-plain"> container </span><span class="token-operator">=</span><span class="token-plain"> document</span><span class="token-punctuation">.</span><span class="token-function">getElementById</span><span class="token-punctuation">(</span><span class="token-string">&quot;root&quot;</span><span class="token-punctuation">)</span></div></div><div></div></code></pre></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-6"><span class="token-punctuation">}</span></div></div><div style="overflow:hidden"><div style="display:inline-block" class="cs-line cs-line-14"><span class="token-keyword">const</span><span class="token-plain"> container </span><span class="token-operator">=</span><span class="token-plain"> document</span><span class="token-punctuation">.</span><span class="token-function">getElementById</span><span class="token-punctuation">(</span><span class="token-string">&quot;root&quot;</span><span class="token-punctuation">)</span></div></div><div></div></code></pre></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-6"><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;opacity:1"><div style="display:inline-block" class="cs-line cs-line-14"><span class="token-keyword">const</span><span class="token-plain"> container </span><span class="token-operator">=</span><span class="token-plain"> document</span><span class="token-punctuation">.</span><span class="token-function">getElementById</span><span class="token-punctuation">(</span><span class="token-string">&quot;root&quot;</span><span class="token-punctuation">)</span></div></div><div></div></code></pre></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden"><div style="display:inline-block" class="cs-line cs-line-6"><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-14"><span class="token-keyword">const</span><span class="token-plain"> container </span><span class="token-operator">=</span><span class="token-plain"> document</span><span class="token-punctuation">.</span><span class="token-function">getElementById</span><span class="token-punctuation">(</span><span class="token-string">&quot;root&quot;</span><span class="token-punctuation">)</span></div></div><div></div></code></pre></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-6"><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-14"><span class="token-keyword">const</span><span class="token-plain"> container </span><span class="token-operator">=</span><span class="token-plain"> document</span><span class="token-punctuation">.</span><span class="token-function">getElementById</span><span class="token-punctuation">(</span><span class="token-string">&quot;root&quot;</span><span class="token-punctuation">)</span></div></div><div></div></code></pre></div></div></div></div></div></div><style data-emotion-css="1bezway">.css-1bezway{padding-top:80px;width:auto;padding-left:0;}@media screen and (min-width:1000px){.css-1bezway{padding-top:0;width:420px;padding-left:85px;}}</style><div class="scroller css-1bezway"><style data-emotion-css="2ept1n">.css-2ept1n{position:relative;padding:0;min-height:400px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border-left:0;}</style><div class="css-2ept1n"><style data-emotion-css="8fpq54">.css-8fpq54{background-color:var(--theme-ui-colors-muted,rgba(175,173,169,0.5));border-radius:3px;position:absolute;left:-24px;}</style><div style="top:0%;bottom:0%;width:3px" class="css-8fpq54"></div><div><style data-emotion-css="c39m66">.css-c39m66{padding:0;margin:0;margin-bottom:28px;font-size:23.08319849451542px;font-family:Montserrat,sans-serif;line-height:1.1;font-weight:900;margin-top:56px;}</style><h3 id="step-zero-review" class="css-c39m66">Step Zero: Review</h3><p class="css-1mv7wyt">But first let’s review some basic concepts. You can skip this step if you already have a good idea of how React, JSX and DOM elements work.</p><p class="css-1mv7wyt">We’ll use this React app, just three lines of code. The first one defines a React element. The next one gets a node from the DOM. The last one renders the React element into the container.</p><p class="css-1mv7wyt"><strong class="css-1vg6q84">Let’s remove all the React specific code and replace it with vanilla JavaScript</strong>.</p></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><p class="css-1mv7wyt">On the first line we have the element, defined with JSX. It isn’t even valid JavaScript, so in order to replace it with vanilla JS, first we need to replace it with valid JS.</p><p class="css-1mv7wyt">JSX is transformed to JS by build tools like Babel. The transformation is usually simple: replace the code inside the tags with a call to <code class="css-iofpht">createElement</code>, passing the tag name, the props and the children as parameters.</p></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><p class="css-1mv7wyt"><code class="css-iofpht">React.createElement</code> creates an object from its arguments. Besides some validations, that’s all it does. So we can safely replace the function call with its output.</p></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><p class="css-1mv7wyt">And this is what an element is, an object with two properties: <code class="css-iofpht">type</code> and <code class="css-iofpht">props</code> (well, <a href="https://github.com/facebook/react/blob/f4cc45ce962adc9f307690e1d5cfa28a288418eb/packages/react/src/ReactElement.js#L111" class="css-1scict0">it has more</a>, but we only care about these two).</p><p class="css-1mv7wyt">The <code class="css-iofpht">type</code> is a string that specifies the type of the DOM node we want to create, it’s the <code class="css-iofpht">tagName</code> you pass to <code class="css-iofpht">document.createElement</code> when you want to create an HTML element. It can also be a function, but we’ll leave that for Step VII.</p><p class="css-1mv7wyt"><code class="css-iofpht">props</code> is another object, it has all the keys and values from the JSX attributes. It also has a special property: <code class="css-iofpht">children</code>.</p><p class="css-1mv7wyt"><code class="css-iofpht">children</code> in this case is a string, but it’s usually an array with more elements. That’s why elements are also trees.</p></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><p class="css-1mv7wyt">The other piece of React code we need to replace is the call to <code class="css-iofpht">ReactDOM.render</code>.</p><p class="css-1mv7wyt"><code class="css-iofpht">render</code> is where React changes the DOM, so let’s do the updates ourselves.</p></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><p class="css-1mv7wyt">First we create a node<!-- -->*<!-- --> using the element <code class="css-iofpht">type</code>, in this case <code class="css-iofpht">h1</code>.</p><p class="css-1mv7wyt">Then we assign all the element <code class="css-iofpht">props</code> to that node. Here it’s just the title.</p><p class="css-1mv7wyt"><em class="css-0">*<!-- --> To avoid confusion, I’ll use “element” to refer to React elements and “node” for DOM elements.</em></p></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><p class="css-1mv7wyt">Then we create the nodes for the children. We only have a string as a child so we create a text node.</p><p class="css-1mv7wyt">Using <code class="css-iofpht">textNode</code> instead of setting <code class="css-iofpht">innerText</code> will allow us to treat all elements in the same way later. Note also how we set the <code class="css-iofpht">nodeValue</code> like we did it with the <code class="css-iofpht">h1</code> title, it’s almost as if the string had <code class="css-iofpht">props: {nodeValue: &quot;hello&quot;}</code>.</p></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><p class="css-1mv7wyt">Finally, we append the <code class="css-iofpht">textNode</code> to the <code class="css-iofpht">h1</code> and the <code class="css-iofpht">h1</code> to the <code class="css-iofpht">container</code>.</p></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><p class="css-1mv7wyt">And now we have the same app as before, but without using React.</p></div></div></div></div><div class="css-1iq4mep"><div class="css-ovklbk"><div style="height:100%;width:100%"><div class="css-7yj60q"><div style="overflow:auto;height:100%;width:100%"><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;transform:translateX(250px);height:0;opacity:0"><div style="display:inline-block" class="cs-line cs-line-13"><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-66"><span class="token-keyword">const</span><span class="token-plain"> element </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-punctuation">(</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-67"><span class="token-plain">  </span><span class="token-punctuation">&lt;</span><span class="token-tag">div</span><span class="token-tag"> </span><span class="token-attr-name">id</span><span class="token-punctuation">=</span><span class="token-punctuation">&quot;</span><span class="token-attr-value">foo</span><span class="token-punctuation">&quot;</span><span class="token-punctuation">&gt;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-68"><span class="token-plain">    </span><span class="token-punctuation">&lt;</span><span class="token-tag">a</span><span class="token-punctuation">&gt;</span><span class="token-plain">bar</span><span class="token-punctuation">&lt;/</span><span class="token-tag">a</span><span class="token-punctuation">&gt;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-69"><span class="token-plain">    </span><span class="token-punctuation">&lt;</span><span class="token-tag">b</span><span class="token-tag"> </span><span class="token-punctuation">/&gt;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-70"><span class="token-plain">  </span><span class="token-punctuation">&lt;/</span><span class="token-tag">div</span><span class="token-punctuation">&gt;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-71"><span class="token-punctuation">)</span></div></div><div style="overflow:hidden"><div style="display:inline-block" class="cs-line cs-line-72"><span class="token-keyword">const</span><span class="token-plain"> container </span><span class="token-operator">=</span><span class="token-plain"> document</span><span class="token-punctuation">.</span><span class="token-function">getElementById</span><span class="token-punctuation">(</span><span class="token-string">&quot;root&quot;</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-74"><span class="token-plain">ReactDOM</span><span class="token-punctuation">.</span><span class="token-function">render</span><span class="token-punctuation">(</span><span class="token-plain">element</span><span class="token-punctuation">,</span><span class="token-plain"> container</span><span class="token-punctuation">)</span></div></div><div></div></code></pre></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;transform:translateX(250px);height:0;opacity:0"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">createElement</span><span class="token-punctuation">(</span><span class="token-parameter">type</span><span class="token-punctuation">,</span><span class="token-parameter"> props</span><span class="token-punctuation">,</span><span class="token-parameter"> </span><span class="token-operator">...</span><span class="token-parameter">children</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-13"><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-72"><span class="token-keyword">const</span><span class="token-plain"> container </span><span class="token-operator">=</span><span class="token-plain"> document</span><span class="token-punctuation">.</span><span class="token-function">getElementById</span><span class="token-punctuation">(</span><span class="token-string">&quot;root&quot;</span><span class="token-punctuation">)</span></div></div><div></div></code></pre></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:1"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">createElement</span><span class="token-punctuation">(</span><span class="token-parameter">type</span><span class="token-punctuation">,</span><span class="token-parameter"> props</span><span class="token-punctuation">,</span><span class="token-parameter"> </span><span class="token-operator">...</span><span class="token-parameter">children</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-13"><span class="token-punctuation">}</span></div></div><div></div></code></pre></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">createElement</span><span class="token-punctuation">(</span><span class="token-parameter">type</span><span class="token-punctuation">,</span><span class="token-parameter"> props</span><span class="token-punctuation">,</span><span class="token-parameter"> </span><span class="token-operator">...</span><span class="token-parameter">children</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-13"><span class="token-punctuation">}</span></div></div><div></div></code></pre></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">createElement</span><span class="token-punctuation">(</span><span class="token-parameter">type</span><span class="token-punctuation">,</span><span class="token-parameter"> props</span><span class="token-punctuation">,</span><span class="token-parameter"> </span><span class="token-operator">...</span><span class="token-parameter">children</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-13"><span class="token-punctuation">}</span></div></div><div></div></code></pre></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">createElement</span><span class="token-punctuation">(</span><span class="token-parameter">type</span><span class="token-punctuation">,</span><span class="token-parameter"> props</span><span class="token-punctuation">,</span><span class="token-parameter"> </span><span class="token-operator">...</span><span class="token-parameter">children</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-13"><span class="token-punctuation">}</span></div></div><div></div></code></pre></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">createElement</span><span class="token-punctuation">(</span><span class="token-parameter">type</span><span class="token-punctuation">,</span><span class="token-parameter"> props</span><span class="token-punctuation">,</span><span class="token-parameter"> </span><span class="token-operator">...</span><span class="token-parameter">children</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-13"><span class="token-punctuation">}</span></div></div><div></div></code></pre></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">createElement</span><span class="token-punctuation">(</span><span class="token-parameter">type</span><span class="token-punctuation">,</span><span class="token-parameter"> props</span><span class="token-punctuation">,</span><span class="token-parameter"> </span><span class="token-operator">...</span><span class="token-parameter">children</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden"><div style="display:inline-block" class="cs-line cs-line-13"><span class="token-punctuation">}</span></div></div><div></div></code></pre></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">createElement</span><span class="token-punctuation">(</span><span class="token-parameter">type</span><span class="token-punctuation">,</span><span class="token-parameter"> props</span><span class="token-punctuation">,</span><span class="token-parameter"> </span><span class="token-operator">...</span><span class="token-parameter">children</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;opacity:1"><div style="display:inline-block" class="cs-line cs-line-13"><span class="token-punctuation">}</span></div></div><div></div></code></pre></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">createElement</span><span class="token-punctuation">(</span><span class="token-parameter">type</span><span class="token-punctuation">,</span><span class="token-parameter"> props</span><span class="token-punctuation">,</span><span class="token-parameter"> </span><span class="token-operator">...</span><span class="token-parameter">children</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-13"><span class="token-punctuation">}</span></div></div><div></div></code></pre></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">createElement</span><span class="token-punctuation">(</span><span class="token-parameter">type</span><span class="token-punctuation">,</span><span class="token-parameter"> props</span><span class="token-punctuation">,</span><span class="token-parameter"> </span><span class="token-operator">...</span><span class="token-parameter">children</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-13"><span class="token-punctuation">}</span></div></div><div></div></code></pre></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">createElement</span><span class="token-punctuation">(</span><span class="token-parameter">type</span><span class="token-punctuation">,</span><span class="token-parameter"> props</span><span class="token-punctuation">,</span><span class="token-parameter"> </span><span class="token-operator">...</span><span class="token-parameter">children</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-13"><span class="token-punctuation">}</span></div></div><div></div></code></pre></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">createElement</span><span class="token-punctuation">(</span><span class="token-parameter">type</span><span class="token-punctuation">,</span><span class="token-parameter"> props</span><span class="token-punctuation">,</span><span class="token-parameter"> </span><span class="token-operator">...</span><span class="token-parameter">children</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-13"><span class="token-punctuation">}</span></div></div><div></div></code></pre></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">createElement</span><span class="token-punctuation">(</span><span class="token-parameter">type</span><span class="token-punctuation">,</span><span class="token-parameter"> props</span><span class="token-punctuation">,</span><span class="token-parameter"> </span><span class="token-operator">...</span><span class="token-parameter">children</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-13"><span class="token-punctuation">}</span></div></div><div></div></code></pre></div></div></div></div></div></div><div class="scroller css-1bezway"><div class="css-2ept1n"><div style="top:0%;bottom:0%;width:3px" class="css-8fpq54"></div><div><h3 id="step-i-the-createelement-function" class="css-c39m66">Step I: The <code class="css-iofpht">createElement</code> Function</h3><p class="css-1mv7wyt">Let’s start again with another app. This time we’ll replace React code with our own version of React.</p><p class="css-1mv7wyt">We’ll start by writing our own <code class="css-iofpht">createElement</code>.</p><p class="css-1mv7wyt">Let’s transform the JSX to JS so we can see the <code class="css-iofpht">createElement</code> calls.</p></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><p class="css-1mv7wyt">As we saw in the previous step, an element is an object with <code class="css-iofpht">type</code> and <code class="css-iofpht">props</code>. The only thing that our function needs to do is create that object.</p></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><p class="css-1mv7wyt">We use the <em class="css-0">spread operator</em> for the <code class="css-iofpht">props</code> and the <em class="css-0">rest parameter syntax</em> for the <code class="css-iofpht">children</code>, this way the <code class="css-iofpht">children</code> prop will always be an array.</p><div class="css-0"><p class="css-1mv7wyt">For example, <code class="css-iofpht">createElement(&quot;div&quot;)</code> returns:</p><style data-emotion-css="3nt8wl">.css-3nt8wl{padding:0;margin:0;margin-bottom:28px;font-size:85%;font-family:Consolas,Menlo,Monaco,source-code-pro,Courier New,monospace;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;overflow:auto;border-radius:10px;padding-left:14px;color:var(--theme-ui-colors-text,rgb(51,51,51));background-color:var(--theme-ui-colors-background,#FAF9F5);white-space:pre-wrap;}.css-3nt8wl .builtin,.css-3nt8wl .changed,.css-3nt8wl .keyword,.css-3nt8wl .punctuation,.css-3nt8wl .operator,.css-3nt8wl .tag,.css-3nt8wl .deleted,.css-3nt8wl .string,.css-3nt8wl .attr-value,.css-3nt8wl .char,.css-3nt8wl .number,.css-3nt8wl .inserted{color:#0f8f5e;}.css-3nt8wl .comment,.css-3nt8wl .cdata,.css-3nt8wl .doctype{font-style:italic;}</style><style data-emotion-css="g6kpu7">.css-g6kpu7{font-size:inherit;font-family:Consolas,Menlo,Monaco,source-code-pro,Courier New,monospace;}</style><style data-emotion-css="266fzy">.css-266fzy{padding:0;margin:0;margin-bottom:28px;font-size:85%;font-family:Consolas,Menlo,Monaco,source-code-pro,Courier New,monospace;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;overflow:auto;border-radius:10px;padding-left:14px;color:var(--theme-ui-colors-text,rgb(51,51,51));background-color:var(--theme-ui-colors-background,#FAF9F5);white-space:pre-wrap;font-size:inherit;font-family:Consolas,Menlo,Monaco,source-code-pro,Courier New,monospace;}.css-266fzy .builtin,.css-266fzy .changed,.css-266fzy .keyword,.css-266fzy .punctuation,.css-266fzy .operator,.css-266fzy .tag,.css-266fzy .deleted,.css-266fzy .string,.css-266fzy .attr-value,.css-266fzy .char,.css-266fzy .number,.css-266fzy .inserted{color:#0f8f5e;}.css-266fzy .comment,.css-266fzy .cdata,.css-266fzy .doctype{font-style:italic;}</style><pre class="language-json prism-code language-json css-266fzy"><div class="token-line"><style data-emotion-css="1baulvz">.css-1baulvz{display:inline-block;}</style><span class="token punctuation css-1baulvz">{</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">  </span><span class="token property css-1baulvz">&quot;type&quot;</span><span class="token operator css-1baulvz">:</span><span class="token plain css-1baulvz"> </span><span class="token string css-1baulvz">&quot;div&quot;</span><span class="token punctuation css-1baulvz">,</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">  </span><span class="token property css-1baulvz">&quot;props&quot;</span><span class="token operator css-1baulvz">:</span><span class="token plain css-1baulvz"> </span><span class="token punctuation css-1baulvz">{</span><span class="token plain css-1baulvz"> </span><span class="token property css-1baulvz">&quot;children&quot;</span><span class="token operator css-1baulvz">:</span><span class="token plain css-1baulvz"> </span><span class="token punctuation css-1baulvz">[</span><span class="token punctuation css-1baulvz">]</span><span class="token plain css-1baulvz"> </span><span class="token punctuation css-1baulvz">}</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz"></span><span class="token punctuation css-1baulvz">}</span></div></pre><p class="css-1mv7wyt"><code class="css-iofpht">createElement(&quot;div&quot;, null, a)</code> returns:</p><pre class="language-json prism-code language-json css-266fzy"><div class="token-line"><span class="token punctuation css-1baulvz">{</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">  </span><span class="token property css-1baulvz">&quot;type&quot;</span><span class="token operator css-1baulvz">:</span><span class="token plain css-1baulvz"> </span><span class="token string css-1baulvz">&quot;div&quot;</span><span class="token punctuation css-1baulvz">,</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">  </span><span class="token property css-1baulvz">&quot;props&quot;</span><span class="token operator css-1baulvz">:</span><span class="token plain css-1baulvz"> </span><span class="token punctuation css-1baulvz">{</span><span class="token plain css-1baulvz"> </span><span class="token property css-1baulvz">&quot;children&quot;</span><span class="token operator css-1baulvz">:</span><span class="token plain css-1baulvz"> </span><span class="token punctuation css-1baulvz">[</span><span class="token plain css-1baulvz">a</span><span class="token punctuation css-1baulvz">]</span><span class="token plain css-1baulvz"> </span><span class="token punctuation css-1baulvz">}</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz"></span><span class="token punctuation css-1baulvz">}</span></div></pre><p class="css-1mv7wyt">and <code class="css-iofpht">createElement(&quot;div&quot;, null, a, b)</code> returns:</p><pre class="language-json prism-code language-json css-266fzy"><div class="token-line"><span class="token punctuation css-1baulvz">{</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">  </span><span class="token property css-1baulvz">&quot;type&quot;</span><span class="token operator css-1baulvz">:</span><span class="token plain css-1baulvz"> </span><span class="token string css-1baulvz">&quot;div&quot;</span><span class="token punctuation css-1baulvz">,</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">  </span><span class="token property css-1baulvz">&quot;props&quot;</span><span class="token operator css-1baulvz">:</span><span class="token plain css-1baulvz"> </span><span class="token punctuation css-1baulvz">{</span><span class="token plain css-1baulvz"> </span><span class="token property css-1baulvz">&quot;children&quot;</span><span class="token operator css-1baulvz">:</span><span class="token plain css-1baulvz"> </span><span class="token punctuation css-1baulvz">[</span><span class="token plain css-1baulvz">a</span><span class="token punctuation css-1baulvz">,</span><span class="token plain css-1baulvz"> b</span><span class="token punctuation css-1baulvz">]</span><span class="token plain css-1baulvz"> </span><span class="token punctuation css-1baulvz">}</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz"></span><span class="token punctuation css-1baulvz">}</span></div></pre></div></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><p class="css-1mv7wyt">The <code class="css-iofpht">children</code> array could also contain primitive values like strings or numbers. So we’ll wrap everything that isn’t an object inside its own element and create a special type for them: <code class="css-iofpht">TEXT_ELEMENT</code>.</p><p class="css-1mv7wyt"><em class="css-0">React doesn’t wrap primitive values or create empty arrays when there aren’t <code class="css-iofpht">children</code>, but we do it because it will simplify our code, and for our library we prefer simple code than performant code.</em></p></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><p class="css-1mv7wyt">We are still using React’s <code class="css-iofpht">createElement</code>.</p><p class="css-1mv7wyt">In order to replace it, let’s give a name to our library. We need a name that sounds like React but also hints its <em class="css-0">didactic</em> purpose.</p></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><p class="css-1mv7wyt">We’ll call it Didact.</p><p class="css-1mv7wyt">But we still want to use JSX here. How do we tell babel to use Didact’s <code class="css-iofpht">createElement</code> instead of React’s?</p></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><p class="css-1mv7wyt">If we have a comment like this one, when babel transpiles the JSX it will use the function we define.</p></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><h3 id="step-ii-the-render-function" class="css-c39m66">Step II: The <code class="css-iofpht">render</code> Function</h3><p class="css-1mv7wyt">Next, we need to write our version of the <code class="css-iofpht">ReactDOM.render</code> function.</p></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><p class="css-1mv7wyt">For now, we only care about adding stuff to the DOM. We’ll handle updating and deleting later.</p></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><p class="css-1mv7wyt">We start by creating the DOM node using the element type, and then append the new node to the container.</p></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><p class="css-1mv7wyt">We recursively do the same for each child.</p></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><p class="css-1mv7wyt">We also need to handle text elements, if the element type is <code class="css-iofpht">TEXT_ELEMENT</code> we create a text node instead of a regular node.</p></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><p class="css-1mv7wyt">The last thing we need to do here is assign the element props to the node.</p></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><p class="css-1mv7wyt">And that’s it. We now have a library that can render JSX to the DOM.</p><p class="css-1mv7wyt">Give it a try on <a href="https://codesandbox.io/s/didact-2-k6rbj" class="css-1scict0">codesandbox</a>.</p></div></div></div></div><h3 id="step-iii-concurrent-mode" class="css-c39m66">Step III: Concurrent Mode</h3><p class="css-1mv7wyt">But… before we start adding more code we need a refactor.</p><div class="css-1iq4mep"><div class="css-ovklbk"><div style="height:100%;width:100%"><div class="css-7yj60q"><div style="overflow:auto;height:100%;width:100%"><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">createElement</span><span class="token-punctuation">(</span><span class="token-parameter">type</span><span class="token-punctuation">,</span><span class="token-parameter"> props</span><span class="token-punctuation">,</span><span class="token-parameter"> </span><span class="token-operator">...</span><span class="token-parameter">children</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-1"><span class="token-plain">  </span><span class="token-keyword">return</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-2"><span class="token-plain">    type</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-3"><span class="token-plain">    props</span><span class="token-operator">:</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-4"><span class="token-plain">      </span><span class="token-operator">...</span><span class="token-plain">props</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-5"><span class="token-plain">      children</span><span class="token-operator">:</span><span class="token-plain"> children</span><span class="token-punctuation">.</span><span class="token-function">map</span><span class="token-punctuation">(</span><span class="token-parameter">child</span><span class="token-plain"> </span><span class="token-operator">=&gt;</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-6"><span class="token-plain">        </span><span class="token-keyword">typeof</span><span class="token-plain"> child </span><span class="token-operator">===</span><span class="token-plain"> </span><span class="token-string">&quot;object&quot;</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-7"><span class="token-plain">          </span><span class="token-operator">?</span><span class="token-plain"> child</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-8"><span class="token-plain">          </span><span class="token-operator">:</span><span class="token-plain"> </span><span class="token-function">createTextElement</span><span class="token-punctuation">(</span><span class="token-plain">child</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-9"><span class="token-plain">      </span><span class="token-punctuation">)</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-10"><span class="token-plain">    </span><span class="token-punctuation">}</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-11"><span class="token-plain">  </span><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-13"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-14"><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">createTextElement</span><span class="token-punctuation">(</span><span class="token-parameter">text</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-15"><span class="token-plain">  </span><span class="token-keyword">return</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-16"><span class="token-plain">    type</span><span class="token-operator">:</span><span class="token-plain"> </span><span class="token-string">&quot;TEXT_ELEMENT&quot;</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-17"><span class="token-plain">    props</span><span class="token-operator">:</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-18"><span class="token-plain">      nodeValue</span><span class="token-operator">:</span><span class="token-plain"> text</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-19"><span class="token-plain">      children</span><span class="token-operator">:</span><span class="token-plain"> </span><span class="token-punctuation">[</span><span class="token-punctuation">]</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-20"><span class="token-plain">    </span><span class="token-punctuation">}</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-21"><span class="token-plain">  </span><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-22"><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-23"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-24"><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">render</span><span class="token-punctuation">(</span><span class="token-parameter">element</span><span class="token-punctuation">,</span><span class="token-parameter"> container</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-25"><span class="token-plain">  </span><span class="token-keyword">const</span><span class="token-plain"> dom </span><span class="token-operator">=</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-26"><span class="token-plain">    element</span><span class="token-punctuation">.</span><span class="token-plain">type </span><span class="token-operator">==</span><span class="token-plain"> </span><span class="token-string">&quot;TEXT_ELEMENT&quot;</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-27"><span class="token-plain">      </span><span class="token-operator">?</span><span class="token-plain"> document</span><span class="token-punctuation">.</span><span class="token-function">createTextNode</span><span class="token-punctuation">(</span><span class="token-string">&quot;&quot;</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-28"><span class="token-plain">      </span><span class="token-operator">:</span><span class="token-plain"> document</span><span class="token-punctuation">.</span><span class="token-function">createElement</span><span class="token-punctuation">(</span><span class="token-plain">element</span><span class="token-punctuation">.</span><span class="token-plain">type</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-29"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-30"><span class="token-plain">  </span><span class="token-keyword">const</span><span class="token-plain"> </span><span class="token-function-variable">isProperty</span><span class="token-plain"> </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-parameter">key</span><span class="token-plain"> </span><span class="token-operator">=&gt;</span><span class="token-plain"> key </span><span class="token-operator">!==</span><span class="token-plain"> </span><span class="token-string">&quot;children&quot;</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-31"><span class="token-plain">  Object</span><span class="token-punctuation">.</span><span class="token-function">keys</span><span class="token-punctuation">(</span><span class="token-plain">element</span><span class="token-punctuation">.</span><span class="token-plain">props</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-32"><span class="token-plain">    </span><span class="token-punctuation">.</span><span class="token-function">filter</span><span class="token-punctuation">(</span><span class="token-plain">isProperty</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-33"><span class="token-plain">    </span><span class="token-punctuation">.</span><span class="token-function">forEach</span><span class="token-punctuation">(</span><span class="token-parameter">name</span><span class="token-plain"> </span><span class="token-operator">=&gt;</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-34"><span class="token-plain">      dom</span><span class="token-punctuation">[</span><span class="token-plain">name</span><span class="token-punctuation">]</span><span class="token-plain"> </span><span class="token-operator">=</span><span class="token-plain"> element</span><span class="token-punctuation">.</span><span class="token-plain">props</span><span class="token-punctuation">[</span><span class="token-plain">name</span><span class="token-punctuation">]</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-35"><span class="token-plain">    </span><span class="token-punctuation">}</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-36"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-37"><span class="token-plain">  element</span><span class="token-punctuation">.</span><span class="token-plain">props</span><span class="token-punctuation">.</span><span class="token-plain">children</span><span class="token-punctuation">.</span><span class="token-function">forEach</span><span class="token-punctuation">(</span><span class="token-parameter">child</span><span class="token-plain"> </span><span class="token-operator">=&gt;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-38"><span class="token-plain">    </span><span class="token-function">render</span><span class="token-punctuation">(</span><span class="token-plain">child</span><span class="token-punctuation">,</span><span class="token-plain"> dom</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-39"><span class="token-plain">  </span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-40"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-41"><span class="token-plain">  container</span><span class="token-punctuation">.</span><span class="token-function">appendChild</span><span class="token-punctuation">(</span><span class="token-plain">dom</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-42"><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-43"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-63"><span class="token-keyword">const</span><span class="token-plain"> Didact </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-64"><span class="token-plain">  createElement</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-65"><span class="token-plain">  render</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-66"><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-67"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-68"><span class="token-comment">/** @jsx Didact.createElement */</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-69"><span class="token-keyword">const</span><span class="token-plain"> element </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-punctuation">(</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-70"><span class="token-plain">  </span><span class="token-punctuation">&lt;</span><span class="token-tag">div</span><span class="token-tag"> </span><span class="token-attr-name">id</span><span class="token-punctuation">=</span><span class="token-punctuation">&quot;</span><span class="token-attr-value">foo</span><span class="token-punctuation">&quot;</span><span class="token-punctuation">&gt;</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-71"><span class="token-plain">    </span><span class="token-punctuation">&lt;</span><span class="token-tag">a</span><span class="token-punctuation">&gt;</span><span class="token-plain">bar</span><span class="token-punctuation">&lt;/</span><span class="token-tag">a</span><span class="token-punctuation">&gt;</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-72"><span class="token-plain">    </span><span class="token-punctuation">&lt;</span><span class="token-tag">b</span><span class="token-tag"> </span><span class="token-punctuation">/&gt;</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-73"><span class="token-plain">  </span><span class="token-punctuation">&lt;/</span><span class="token-tag">div</span><span class="token-punctuation">&gt;</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-74"><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-75"><span class="token-keyword">const</span><span class="token-plain"> container </span><span class="token-operator">=</span><span class="token-plain"> document</span><span class="token-punctuation">.</span><span class="token-function">getElementById</span><span class="token-punctuation">(</span><span class="token-string">&quot;root&quot;</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-76"><span class="token-plain">Didact</span><span class="token-punctuation">.</span><span class="token-function">render</span><span class="token-punctuation">(</span><span class="token-plain">element</span><span class="token-punctuation">,</span><span class="token-plain"> container</span><span class="token-punctuation">)</span></div></div><div></div></code></pre></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">createElement</span><span class="token-punctuation">(</span><span class="token-parameter">type</span><span class="token-punctuation">,</span><span class="token-parameter"> props</span><span class="token-punctuation">,</span><span class="token-parameter"> </span><span class="token-operator">...</span><span class="token-parameter">children</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-punctuation">}</span></div></div><div></div></code></pre></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">createElement</span><span class="token-punctuation">(</span><span class="token-parameter">type</span><span class="token-punctuation">,</span><span class="token-parameter"> props</span><span class="token-punctuation">,</span><span class="token-parameter"> </span><span class="token-operator">...</span><span class="token-parameter">children</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-punctuation">}</span></div></div><div></div></code></pre></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">createElement</span><span class="token-punctuation">(</span><span class="token-parameter">type</span><span class="token-punctuation">,</span><span class="token-parameter"> props</span><span class="token-punctuation">,</span><span class="token-parameter"> </span><span class="token-operator">...</span><span class="token-parameter">children</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-punctuation">}</span></div></div><div></div></code></pre></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">createElement</span><span class="token-punctuation">(</span><span class="token-parameter">type</span><span class="token-punctuation">,</span><span class="token-parameter"> props</span><span class="token-punctuation">,</span><span class="token-parameter"> </span><span class="token-operator">...</span><span class="token-parameter">children</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-punctuation">}</span></div></div><div></div></code></pre></div></div></div></div></div></div><div class="scroller css-1bezway"><div class="css-2ept1n"><div style="top:0%;bottom:0%;width:3px" class="css-8fpq54"></div><div><p class="css-1mv7wyt">There’s a problem with this recursive call.</p><p class="css-1mv7wyt">Once we start rendering, we won’t stop until we have rendered the complete element tree.
If the element tree is big, it may block the main thread for too long. And if the browser needs to do high priority stuff like handling user input or keeping an animation smooth, it will have to wait until the render finishes.</p></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><p class="css-1mv7wyt">So we are going to break the work into small units, and after we finish each unit we’ll let the browser interrupt the rendering if there’s anything else that needs to be done.</p></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><p class="css-1mv7wyt">We use <code class="css-iofpht">requestIdleCallback</code> to make a loop. You can think of <code class="css-iofpht">requestIdleCallback</code> as a <code class="css-iofpht">setTimeout</code>, but instead of us telling it when to run, the browser will run the callback when the main thread is idle.</p><p class="css-1mv7wyt"><em class="css-0">React <a href="https://github.com/facebook/react/issues/11171#issuecomment-417349573" class="css-1scict0">doesn’t use <code class="css-iofpht">requestIdleCallback</code> anymore</a>. Now it uses the <a href="https://github.com/facebook/react/tree/master/packages/scheduler" class="css-1scict0">scheduler package</a>. But for this use case it’s conceptually the same.</em></p></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><p class="css-1mv7wyt"><code class="css-iofpht">requestIdleCallback</code> also gives us a deadline parameter. We can use it to check how much time we have until the browser needs to take control again.</p><div class="css-0"><p class="css-1mv7wyt"><em class="css-0">As of November 2019, Concurrent Mode isn’t stable in React yet. The stable version of the loop looks more like this:</em>	</p><pre class="language-js prism-code language-javascript css-266fzy"><div class="token-line"><span class="token keyword css-1baulvz">while</span><span class="token plain css-1baulvz"> </span><span class="token punctuation css-1baulvz">(</span><span class="token plain css-1baulvz">nextUnitOfWork</span><span class="token punctuation css-1baulvz">)</span><span class="token plain css-1baulvz"> </span><span class="token punctuation css-1baulvz">{</span><span class="token plain css-1baulvz">    </span></div><div class="token-line"><span class="token plain css-1baulvz">  nextUnitOfWork </span><span class="token operator css-1baulvz">=</span><span class="token plain css-1baulvz"> </span><span class="token function css-1baulvz">performUnitOfWork</span><span class="token punctuation css-1baulvz">(</span><span class="token plain css-1baulvz">   </span></div><div class="token-line"><span class="token plain css-1baulvz">    nextUnitOfWork  </span></div><div class="token-line"><span class="token plain css-1baulvz">  </span><span class="token punctuation css-1baulvz">)</span><span class="token plain css-1baulvz"> </span></div><div class="token-line"><span class="token plain css-1baulvz"></span><span class="token punctuation css-1baulvz">}</span></div></pre></div></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><p class="css-1mv7wyt">To start using the loop we’ll need to set the first unit of work, and then write a <code class="css-iofpht">performUnitOfWork</code> function that not only performs the work but also returns the next unit of work.</p></div></div></div></div><h3 id="step-iv-fibers" class="css-c39m66">Step IV: Fibers</h3><p class="css-1mv7wyt">To organize the units of work we’ll need a data structure: a fiber tree.</p><p class="css-1mv7wyt">We’ll have one fiber for each element and each fiber will be a unit of work.</p><p class="css-1mv7wyt">Let me show you with an example.</p><div class="css-1iq4mep"><style data-emotion-css="cdrb5l">.css-cdrb5l{width:100vw;margin-left:calc(50% - 50vw);position:-webkit-sticky;position:sticky;top:0;z-index:1;height:50vh;padding-right:0;background-color:var(--theme-ui-colors-darkBackground,#202226);}@media screen and (min-width:1000px){.css-cdrb5l{width:420px;margin-left:0;position:static;top:auto;z-index:auto;height:auto;padding-right:85px;}}</style><div class="css-cdrb5l"><div class="css-7yj60q"><style data-emotion-css="ju4bqw">.css-ju4bqw{position:absolute;height:100%;width:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}</style><div style="opacity:1" class="css-ju4bqw"><style data-emotion-css="12yi5u7">.css-12yi5u7{padding:0;margin:0;margin-bottom:28px;max-width:100%;}</style><img class="gatsby-resp-image-image css-12yi5u7" alt="Fiber Tree 0" title="Fiber Tree 0" src="/static/de664d437c94d478778b965c66c91f99/d3fa7/fiber0.png" srcSet="/static/de664d437c94d478778b965c66c91f99/79c17/fiber0.png 105w,/static/de664d437c94d478778b965c66c91f99/65ed1/fiber0.png 210w,/static/de664d437c94d478778b965c66c91f99/d3fa7/fiber0.png 274w" sizes="(max-width: 274px) 100vw, 274px" style="object-fit:contain;margin:0" loading="lazy"/></div><div style="opacity:0" class="css-ju4bqw"><img class="gatsby-resp-image-image css-12yi5u7" alt="Fiber Tree 1" title="Fiber Tree 1" src="/static/a88a3ec01855349c14302f6da28e2b0c/d3fa7/fiber1.png" srcSet="/static/a88a3ec01855349c14302f6da28e2b0c/79c17/fiber1.png 105w,/static/a88a3ec01855349c14302f6da28e2b0c/65ed1/fiber1.png 210w,/static/a88a3ec01855349c14302f6da28e2b0c/d3fa7/fiber1.png 274w" sizes="(max-width: 274px) 100vw, 274px" style="object-fit:contain;margin:0" loading="lazy"/></div></div></div><div class="scroller css-1bezway"><div class="css-2ept1n"><div style="top:0%;bottom:0%;width:3px" class="css-8fpq54"></div><div><p class="css-1mv7wyt">Suppose we want to render an element tree like this one:</p><pre class="language-jsx prism-code language-jsx css-266fzy"><div class="token-line"><span class="token plain css-1baulvz">Didact</span><span class="token punctuation css-1baulvz">.</span><span class="token function css-1baulvz">render</span><span class="token punctuation css-1baulvz">(</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">  </span><span class="token tag punctuation css-1baulvz">&lt;</span><span class="token tag css-1baulvz">div</span><span class="token tag punctuation css-1baulvz">&gt;</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">    </span><span class="token tag punctuation css-1baulvz">&lt;</span><span class="token tag css-1baulvz">h1</span><span class="token tag punctuation css-1baulvz">&gt;</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">      </span><span class="token tag punctuation css-1baulvz">&lt;</span><span class="token tag css-1baulvz">p</span><span class="token tag css-1baulvz"> </span><span class="token tag punctuation css-1baulvz">/&gt;</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">      </span><span class="token tag punctuation css-1baulvz">&lt;</span><span class="token tag css-1baulvz">a</span><span class="token tag css-1baulvz"> </span><span class="token tag punctuation css-1baulvz">/&gt;</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">    </span><span class="token tag punctuation css-1baulvz">&lt;/</span><span class="token tag css-1baulvz">h1</span><span class="token tag punctuation css-1baulvz">&gt;</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">    </span><span class="token tag punctuation css-1baulvz">&lt;</span><span class="token tag css-1baulvz">h2</span><span class="token tag css-1baulvz"> </span><span class="token tag punctuation css-1baulvz">/&gt;</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">  </span><span class="token tag punctuation css-1baulvz">&lt;/</span><span class="token tag css-1baulvz">div</span><span class="token tag punctuation css-1baulvz">&gt;</span><span class="token punctuation css-1baulvz">,</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">  container</span></div><div class="token-line"><span class="token plain css-1baulvz"></span><span class="token punctuation css-1baulvz">)</span></div></pre><p class="css-1mv7wyt">In the <code class="css-iofpht">render</code> we’ll create the root fiber and set it as the <code class="css-iofpht">nextUnitOfWork</code>. The rest of the work will happen on the <code class="css-iofpht">performUnitOfWork</code> function, there we will do three things for each fiber:</p><ol class="css-wf0k3i"><li class="css-16s26jd">add the element to the DOM</li><li class="css-16s26jd">create the fibers for the element’s children</li><li class="css-16s26jd">select the next unit of work</li></ol></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><p class="css-1mv7wyt">One of the goals of this data structure is to make it easy to find the next unit of work. That’s why each fiber has a link to its first child, its next sibling and its parent.</p></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><p class="css-1mv7wyt">When we finish performing work on a fiber, if it has a <code class="css-iofpht">child</code> that fiber will be the next unit of work.</p><p class="css-1mv7wyt">From our example, when we finish working on the <code class="css-iofpht">div</code> fiber the next unit of work will be the <code class="css-iofpht">h1</code> fiber.</p></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><p class="css-1mv7wyt">If the fiber doesn’t have a <code class="css-iofpht">child</code>, we use the <code class="css-iofpht">sibling</code> as the next unit of work.</p><p class="css-1mv7wyt">For example, the <code class="css-iofpht">p</code> fiber doesn’t have a <code class="css-iofpht">child</code> so we move to the <code class="css-iofpht">a</code> fiber after finishing it.</p></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><p class="css-1mv7wyt">And if the fiber doesn’t have a <code class="css-iofpht">child</code> nor a <code class="css-iofpht">sibling</code> we go to the “uncle”: the <code class="css-iofpht">sibling</code> of the <code class="css-iofpht">parent</code>. Like <code class="css-iofpht">a</code> and <code class="css-iofpht">h2</code> fibers from the example.</p><p class="css-1mv7wyt">Also, if the <code class="css-iofpht">parent</code> doesn’t have a <code class="css-iofpht">sibling</code>, we keep going up through the <code class="css-iofpht">parent</code>s until we find one with a <code class="css-iofpht">sibling</code> or until we reach the root. If we have reached the root, it means we have finished performing all the work for this <code class="css-iofpht">render</code>.</p></div></div></div></div><p class="css-1mv7wyt">Now let’s put it into code.</p><div class="css-1iq4mep"><div class="css-ovklbk"><div style="height:100%;width:100%"><div class="css-7yj60q"><div style="overflow:auto;height:100%;width:100%"><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">createElement</span><span class="token-punctuation">(</span><span class="token-parameter">type</span><span class="token-punctuation">,</span><span class="token-parameter"> props</span><span class="token-punctuation">,</span><span class="token-parameter"> </span><span class="token-operator">...</span><span class="token-parameter">children</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-1"><span class="token-plain">  </span><span class="token-keyword">return</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-2"><span class="token-plain">    type</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-3"><span class="token-plain">    props</span><span class="token-operator">:</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-4"><span class="token-plain">      </span><span class="token-operator">...</span><span class="token-plain">props</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-5"><span class="token-plain">      children</span><span class="token-operator">:</span><span class="token-plain"> children</span><span class="token-punctuation">.</span><span class="token-function">map</span><span class="token-punctuation">(</span><span class="token-parameter">child</span><span class="token-plain"> </span><span class="token-operator">=&gt;</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-6"><span class="token-plain">        </span><span class="token-keyword">typeof</span><span class="token-plain"> child </span><span class="token-operator">===</span><span class="token-plain"> </span><span class="token-string">&quot;object&quot;</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-7"><span class="token-plain">          </span><span class="token-operator">?</span><span class="token-plain"> child</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-8"><span class="token-plain">          </span><span class="token-operator">:</span><span class="token-plain"> </span><span class="token-function">createTextElement</span><span class="token-punctuation">(</span><span class="token-plain">child</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-9"><span class="token-plain">      </span><span class="token-punctuation">)</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-10"><span class="token-plain">    </span><span class="token-punctuation">}</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-11"><span class="token-plain">  </span><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-13"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-14"><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">createTextElement</span><span class="token-punctuation">(</span><span class="token-parameter">text</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-15"><span class="token-plain">  </span><span class="token-keyword">return</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-16"><span class="token-plain">    type</span><span class="token-operator">:</span><span class="token-plain"> </span><span class="token-string">&quot;TEXT_ELEMENT&quot;</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-17"><span class="token-plain">    props</span><span class="token-operator">:</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-18"><span class="token-plain">      nodeValue</span><span class="token-operator">:</span><span class="token-plain"> text</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-19"><span class="token-plain">      children</span><span class="token-operator">:</span><span class="token-plain"> </span><span class="token-punctuation">[</span><span class="token-punctuation">]</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-20"><span class="token-plain">    </span><span class="token-punctuation">}</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-21"><span class="token-plain">  </span><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-22"><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-23"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-25"><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">render</span><span class="token-punctuation">(</span><span class="token-parameter">element</span><span class="token-punctuation">,</span><span class="token-parameter"> container</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-26"><span class="token-plain">  </span><span class="token-keyword">const</span><span class="token-plain"> dom </span><span class="token-operator">=</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-28"><span class="token-plain">    element</span><span class="token-punctuation">.</span><span class="token-plain">type </span><span class="token-operator">==</span><span class="token-plain"> </span><span class="token-string">&quot;TEXT_ELEMENT&quot;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-29"><span class="token-plain">      </span><span class="token-operator">?</span><span class="token-plain"> document</span><span class="token-punctuation">.</span><span class="token-function">createTextNode</span><span class="token-punctuation">(</span><span class="token-string">&quot;&quot;</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-31"><span class="token-plain">      </span><span class="token-operator">:</span><span class="token-plain"> document</span><span class="token-punctuation">.</span><span class="token-function">createElement</span><span class="token-punctuation">(</span><span class="token-plain">element</span><span class="token-punctuation">.</span><span class="token-plain">type</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-32"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-34"><span class="token-plain">  </span><span class="token-keyword">const</span><span class="token-plain"> </span><span class="token-function-variable">isProperty</span><span class="token-plain"> </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-parameter">key</span><span class="token-plain"> </span><span class="token-operator">=&gt;</span><span class="token-plain"> key </span><span class="token-operator">!==</span><span class="token-plain"> </span><span class="token-string">&quot;children&quot;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-36"><span class="token-plain">  Object</span><span class="token-punctuation">.</span><span class="token-function">keys</span><span class="token-punctuation">(</span><span class="token-plain">element</span><span class="token-punctuation">.</span><span class="token-plain">props</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-37"><span class="token-plain">    </span><span class="token-punctuation">.</span><span class="token-function">filter</span><span class="token-punctuation">(</span><span class="token-plain">isProperty</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-38"><span class="token-plain">    </span><span class="token-punctuation">.</span><span class="token-function">forEach</span><span class="token-punctuation">(</span><span class="token-parameter">name</span><span class="token-plain"> </span><span class="token-operator">=&gt;</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-40"><span class="token-plain">      dom</span><span class="token-punctuation">[</span><span class="token-plain">name</span><span class="token-punctuation">]</span><span class="token-plain"> </span><span class="token-operator">=</span><span class="token-plain"> element</span><span class="token-punctuation">.</span><span class="token-plain">props</span><span class="token-punctuation">[</span><span class="token-plain">name</span><span class="token-punctuation">]</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-41"><span class="token-plain">    </span><span class="token-punctuation">}</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-42"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-45"><span class="token-plain">  element</span><span class="token-punctuation">.</span><span class="token-plain">props</span><span class="token-punctuation">.</span><span class="token-plain">children</span><span class="token-punctuation">.</span><span class="token-function">forEach</span><span class="token-punctuation">(</span><span class="token-parameter">child</span><span class="token-plain"> </span><span class="token-operator">=&gt;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-46"><span class="token-plain">    </span><span class="token-function">render</span><span class="token-punctuation">(</span><span class="token-plain">child</span><span class="token-punctuation">,</span><span class="token-plain"> dom</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-47"><span class="token-plain">  </span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-48"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-156"><span class="token-plain">  container</span><span class="token-punctuation">.</span><span class="token-function">appendChild</span><span class="token-punctuation">(</span><span class="token-plain">dom</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-157"><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-158"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-159"><span class="token-keyword">let</span><span class="token-plain"> nextUnitOfWork </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-keyword">null</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-163"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-164"><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">workLoop</span><span class="token-punctuation">(</span><span class="token-parameter">deadline</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-165"><span class="token-plain">  </span><span class="token-keyword">let</span><span class="token-plain"> shouldYield </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-boolean">false</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-166"><span class="token-plain">  </span><span class="token-keyword">while</span><span class="token-plain"> </span><span class="token-punctuation">(</span><span class="token-plain">nextUnitOfWork </span><span class="token-operator">&amp;&amp;</span><span class="token-plain"> </span><span class="token-operator">!</span><span class="token-plain">shouldYield</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-167"><span class="token-plain">    nextUnitOfWork </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-function">performUnitOfWork</span><span class="token-punctuation">(</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-168"><span class="token-plain">      nextUnitOfWork</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-169"><span class="token-plain">    </span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-170"><span class="token-plain">    shouldYield </span><span class="token-operator">=</span><span class="token-plain"> deadline</span><span class="token-punctuation">.</span><span class="token-function">timeRemaining</span><span class="token-punctuation">(</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-operator">&lt;</span><span class="token-plain"> </span><span class="token-number">1</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-171"><span class="token-plain">  </span><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-177"><span class="token-plain">  </span><span class="token-function">requestIdleCallback</span><span class="token-punctuation">(</span><span class="token-plain">workLoop</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-178"><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-179"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-180"><span class="token-function">requestIdleCallback</span><span class="token-punctuation">(</span><span class="token-plain">workLoop</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-181"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-289"><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">performUnitOfWork</span><span class="token-punctuation">(</span><span class="token-parameter">nextUnitOfWork</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-290"><span class="token-plain">  </span><span class="token-comment">// TODO</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-291"><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-292"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-293"><span class="token-keyword">const</span><span class="token-plain"> Didact </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-294"><span class="token-plain">  createElement</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-295"><span class="token-plain">  render</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-296"><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-297"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-298"><span class="token-comment">/** @jsx Didact.createElement */</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-299"><span class="token-keyword">const</span><span class="token-plain"> element </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-punctuation">(</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-300"><span class="token-plain">  </span><span class="token-punctuation">&lt;</span><span class="token-tag">div</span><span class="token-tag"> </span><span class="token-attr-name">id</span><span class="token-punctuation">=</span><span class="token-punctuation">&quot;</span><span class="token-attr-value">foo</span><span class="token-punctuation">&quot;</span><span class="token-punctuation">&gt;</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-301"><span class="token-plain">    </span><span class="token-punctuation">&lt;</span><span class="token-tag">a</span><span class="token-punctuation">&gt;</span><span class="token-plain">bar</span><span class="token-punctuation">&lt;/</span><span class="token-tag">a</span><span class="token-punctuation">&gt;</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-302"><span class="token-plain">    </span><span class="token-punctuation">&lt;</span><span class="token-tag">b</span><span class="token-tag"> </span><span class="token-punctuation">/&gt;</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-303"><span class="token-plain">  </span><span class="token-punctuation">&lt;/</span><span class="token-tag">div</span><span class="token-punctuation">&gt;</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-304"><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-305"><span class="token-keyword">const</span><span class="token-plain"> container </span><span class="token-operator">=</span><span class="token-plain"> document</span><span class="token-punctuation">.</span><span class="token-function">getElementById</span><span class="token-punctuation">(</span><span class="token-string">&quot;root&quot;</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-306"><span class="token-plain">Didact</span><span class="token-punctuation">.</span><span class="token-function">render</span><span class="token-punctuation">(</span><span class="token-plain">element</span><span class="token-punctuation">,</span><span class="token-plain"> container</span><span class="token-punctuation">)</span></div></div><div></div></code></pre></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">createElement</span><span class="token-punctuation">(</span><span class="token-parameter">type</span><span class="token-punctuation">,</span><span class="token-parameter"> props</span><span class="token-punctuation">,</span><span class="token-parameter"> </span><span class="token-operator">...</span><span class="token-parameter">children</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-punctuation">}</span></div></div><div></div></code></pre></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">createElement</span><span class="token-punctuation">(</span><span class="token-parameter">type</span><span class="token-punctuation">,</span><span class="token-parameter"> props</span><span class="token-punctuation">,</span><span class="token-parameter"> </span><span class="token-operator">...</span><span class="token-parameter">children</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-punctuation">}</span></div></div><div></div></code></pre></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">createElement</span><span class="token-punctuation">(</span><span class="token-parameter">type</span><span class="token-punctuation">,</span><span class="token-parameter"> props</span><span class="token-punctuation">,</span><span class="token-parameter"> </span><span class="token-operator">...</span><span class="token-parameter">children</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-punctuation">}</span></div></div><div></div></code></pre></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">createElement</span><span class="token-punctuation">(</span><span class="token-parameter">type</span><span class="token-punctuation">,</span><span class="token-parameter"> props</span><span class="token-punctuation">,</span><span class="token-parameter"> </span><span class="token-operator">...</span><span class="token-parameter">children</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-punctuation">}</span></div></div><div></div></code></pre></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">createElement</span><span class="token-punctuation">(</span><span class="token-parameter">type</span><span class="token-punctuation">,</span><span class="token-parameter"> props</span><span class="token-punctuation">,</span><span class="token-parameter"> </span><span class="token-operator">...</span><span class="token-parameter">children</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-punctuation">}</span></div></div><div></div></code></pre></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">createElement</span><span class="token-punctuation">(</span><span class="token-parameter">type</span><span class="token-punctuation">,</span><span class="token-parameter"> props</span><span class="token-punctuation">,</span><span class="token-parameter"> </span><span class="token-operator">...</span><span class="token-parameter">children</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-punctuation">}</span></div></div><div></div></code></pre></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">createElement</span><span class="token-punctuation">(</span><span class="token-parameter">type</span><span class="token-punctuation">,</span><span class="token-parameter"> props</span><span class="token-punctuation">,</span><span class="token-parameter"> </span><span class="token-operator">...</span><span class="token-parameter">children</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-punctuation">}</span></div></div><div></div></code></pre></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">createElement</span><span class="token-punctuation">(</span><span class="token-parameter">type</span><span class="token-punctuation">,</span><span class="token-parameter"> props</span><span class="token-punctuation">,</span><span class="token-parameter"> </span><span class="token-operator">...</span><span class="token-parameter">children</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-punctuation">}</span></div></div><div></div></code></pre></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">createElement</span><span class="token-punctuation">(</span><span class="token-parameter">type</span><span class="token-punctuation">,</span><span class="token-parameter"> props</span><span class="token-punctuation">,</span><span class="token-parameter"> </span><span class="token-operator">...</span><span class="token-parameter">children</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-punctuation">}</span></div></div><div></div></code></pre></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">createElement</span><span class="token-punctuation">(</span><span class="token-parameter">type</span><span class="token-punctuation">,</span><span class="token-parameter"> props</span><span class="token-punctuation">,</span><span class="token-parameter"> </span><span class="token-operator">...</span><span class="token-parameter">children</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-punctuation">}</span></div></div><div></div></code></pre></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">createElement</span><span class="token-punctuation">(</span><span class="token-parameter">type</span><span class="token-punctuation">,</span><span class="token-parameter"> props</span><span class="token-punctuation">,</span><span class="token-parameter"> </span><span class="token-operator">...</span><span class="token-parameter">children</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-punctuation">}</span></div></div><div></div></code></pre></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">createElement</span><span class="token-punctuation">(</span><span class="token-parameter">type</span><span class="token-punctuation">,</span><span class="token-parameter"> props</span><span class="token-punctuation">,</span><span class="token-parameter"> </span><span class="token-operator">...</span><span class="token-parameter">children</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-punctuation">}</span></div></div><div></div></code></pre></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">createElement</span><span class="token-punctuation">(</span><span class="token-parameter">type</span><span class="token-punctuation">,</span><span class="token-parameter"> props</span><span class="token-punctuation">,</span><span class="token-parameter"> </span><span class="token-operator">...</span><span class="token-parameter">children</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-punctuation">}</span></div></div><div></div></code></pre></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">createElement</span><span class="token-punctuation">(</span><span class="token-parameter">type</span><span class="token-punctuation">,</span><span class="token-parameter"> props</span><span class="token-punctuation">,</span><span class="token-parameter"> </span><span class="token-operator">...</span><span class="token-parameter">children</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-punctuation">}</span></div></div><div></div></code></pre></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">createElement</span><span class="token-punctuation">(</span><span class="token-parameter">type</span><span class="token-punctuation">,</span><span class="token-parameter"> props</span><span class="token-punctuation">,</span><span class="token-parameter"> </span><span class="token-operator">...</span><span class="token-parameter">children</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-punctuation">}</span></div></div><div></div></code></pre></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">createElement</span><span class="token-punctuation">(</span><span class="token-parameter">type</span><span class="token-punctuation">,</span><span class="token-parameter"> props</span><span class="token-punctuation">,</span><span class="token-parameter"> </span><span class="token-operator">...</span><span class="token-parameter">children</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-punctuation">}</span></div></div><div></div></code></pre></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">createElement</span><span class="token-punctuation">(</span><span class="token-parameter">type</span><span class="token-punctuation">,</span><span class="token-parameter"> props</span><span class="token-punctuation">,</span><span class="token-parameter"> </span><span class="token-operator">...</span><span class="token-parameter">children</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-punctuation">}</span></div></div><div></div></code></pre></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">createElement</span><span class="token-punctuation">(</span><span class="token-parameter">type</span><span class="token-punctuation">,</span><span class="token-parameter"> props</span><span class="token-punctuation">,</span><span class="token-parameter"> </span><span class="token-operator">...</span><span class="token-parameter">children</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-punctuation">}</span></div></div><div></div></code></pre></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">createElement</span><span class="token-punctuation">(</span><span class="token-parameter">type</span><span class="token-punctuation">,</span><span class="token-parameter"> props</span><span class="token-punctuation">,</span><span class="token-parameter"> </span><span class="token-operator">...</span><span class="token-parameter">children</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-punctuation">}</span></div></div><div></div></code></pre></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">createElement</span><span class="token-punctuation">(</span><span class="token-parameter">type</span><span class="token-punctuation">,</span><span class="token-parameter"> props</span><span class="token-punctuation">,</span><span class="token-parameter"> </span><span class="token-operator">...</span><span class="token-parameter">children</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-punctuation">}</span></div></div><div></div></code></pre></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">createElement</span><span class="token-punctuation">(</span><span class="token-parameter">type</span><span class="token-punctuation">,</span><span class="token-parameter"> props</span><span class="token-punctuation">,</span><span class="token-parameter"> </span><span class="token-operator">...</span><span class="token-parameter">children</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-punctuation">}</span></div></div><div></div></code></pre></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">createElement</span><span class="token-punctuation">(</span><span class="token-parameter">type</span><span class="token-punctuation">,</span><span class="token-parameter"> props</span><span class="token-punctuation">,</span><span class="token-parameter"> </span><span class="token-operator">...</span><span class="token-parameter">children</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-punctuation">}</span></div></div><div></div></code></pre></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">createElement</span><span class="token-punctuation">(</span><span class="token-parameter">type</span><span class="token-punctuation">,</span><span class="token-parameter"> props</span><span class="token-punctuation">,</span><span class="token-parameter"> </span><span class="token-operator">...</span><span class="token-parameter">children</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-punctuation">}</span></div></div><div></div></code></pre></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">createElement</span><span class="token-punctuation">(</span><span class="token-parameter">type</span><span class="token-punctuation">,</span><span class="token-parameter"> props</span><span class="token-punctuation">,</span><span class="token-parameter"> </span><span class="token-operator">...</span><span class="token-parameter">children</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-punctuation">}</span></div></div><div></div></code></pre></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">createElement</span><span class="token-punctuation">(</span><span class="token-parameter">type</span><span class="token-punctuation">,</span><span class="token-parameter"> props</span><span class="token-punctuation">,</span><span class="token-parameter"> </span><span class="token-operator">...</span><span class="token-parameter">children</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-punctuation">}</span></div></div><div></div></code></pre></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">createElement</span><span class="token-punctuation">(</span><span class="token-parameter">type</span><span class="token-punctuation">,</span><span class="token-parameter"> props</span><span class="token-punctuation">,</span><span class="token-parameter"> </span><span class="token-operator">...</span><span class="token-parameter">children</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-punctuation">}</span></div></div><div></div></code></pre></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">createElement</span><span class="token-punctuation">(</span><span class="token-parameter">type</span><span class="token-punctuation">,</span><span class="token-parameter"> props</span><span class="token-punctuation">,</span><span class="token-parameter"> </span><span class="token-operator">...</span><span class="token-parameter">children</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-punctuation">}</span></div></div><div></div></code></pre></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">createElement</span><span class="token-punctuation">(</span><span class="token-parameter">type</span><span class="token-punctuation">,</span><span class="token-parameter"> props</span><span class="token-punctuation">,</span><span class="token-parameter"> </span><span class="token-operator">...</span><span class="token-parameter">children</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-punctuation">}</span></div></div><div></div></code></pre></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">createElement</span><span class="token-punctuation">(</span><span class="token-parameter">type</span><span class="token-punctuation">,</span><span class="token-parameter"> props</span><span class="token-punctuation">,</span><span class="token-parameter"> </span><span class="token-operator">...</span><span class="token-parameter">children</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;transform:translateX(250px);height:0;opacity:0"><div style="display:inline-block" class="cs-line cs-line-55"><span class="token-keyword">const</span><span class="token-plain"> </span><span class="token-function-variable">isGone</span><span class="token-plain"> </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-punctuation">(</span><span class="token-parameter">prev</span><span class="token-punctuation">,</span><span class="token-parameter"> next</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-operator">=&gt;</span><span class="token-plain"> </span><span class="token-parameter">key</span><span class="token-plain"> </span><span class="token-operator">=&gt;</span><span class="token-plain"> </span><span class="token-operator">!</span><span class="token-punctuation">(</span><span class="token-plain">key </span><span class="token-keyword">in</span><span class="token-plain"> next</span><span class="token-punctuation">)</span></div></div><div></div></code></pre></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-55"><span class="token-keyword">const</span><span class="token-plain"> </span><span class="token-function-variable">isGone</span><span class="token-plain"> </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-punctuation">(</span><span class="token-parameter">prev</span><span class="token-punctuation">,</span><span class="token-parameter"> next</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-operator">=&gt;</span><span class="token-plain"> </span><span class="token-parameter">key</span><span class="token-plain"> </span><span class="token-operator">=&gt;</span><span class="token-plain"> </span><span class="token-operator">!</span><span class="token-punctuation">(</span><span class="token-plain">key </span><span class="token-keyword">in</span><span class="token-plain"> next</span><span class="token-punctuation">)</span></div></div><div></div></code></pre></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-55"><span class="token-keyword">const</span><span class="token-plain"> </span><span class="token-function-variable">isGone</span><span class="token-plain"> </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-punctuation">(</span><span class="token-parameter">prev</span><span class="token-punctuation">,</span><span class="token-parameter"> next</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-operator">=&gt;</span><span class="token-plain"> </span><span class="token-parameter">key</span><span class="token-plain"> </span><span class="token-operator">=&gt;</span><span class="token-plain"> </span><span class="token-operator">!</span><span class="token-punctuation">(</span><span class="token-plain">key </span><span class="token-keyword">in</span><span class="token-plain"> next</span><span class="token-punctuation">)</span></div></div><div></div></code></pre></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-55"><span class="token-keyword">const</span><span class="token-plain"> </span><span class="token-function-variable">isGone</span><span class="token-plain"> </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-punctuation">(</span><span class="token-parameter">prev</span><span class="token-punctuation">,</span><span class="token-parameter"> next</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-operator">=&gt;</span><span class="token-plain"> </span><span class="token-parameter">key</span><span class="token-plain"> </span><span class="token-operator">=&gt;</span><span class="token-plain"> </span><span class="token-operator">!</span><span class="token-punctuation">(</span><span class="token-plain">key </span><span class="token-keyword">in</span><span class="token-plain"> next</span><span class="token-punctuation">)</span></div></div><div></div></code></pre></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-55"><span class="token-keyword">const</span><span class="token-plain"> </span><span class="token-function-variable">isGone</span><span class="token-plain"> </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-punctuation">(</span><span class="token-parameter">prev</span><span class="token-punctuation">,</span><span class="token-parameter"> next</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-operator">=&gt;</span><span class="token-plain"> </span><span class="token-parameter">key</span><span class="token-plain"> </span><span class="token-operator">=&gt;</span><span class="token-plain"> </span><span class="token-operator">!</span><span class="token-punctuation">(</span><span class="token-plain">key </span><span class="token-keyword">in</span><span class="token-plain"> next</span><span class="token-punctuation">)</span></div></div><div></div></code></pre></div></div></div></div></div></div><div class="scroller css-1bezway"><div class="css-2ept1n"><div style="top:0%;bottom:0%;width:3px" class="css-8fpq54"></div><div><p class="css-1mv7wyt">First, let’s remove this code from the <code class="css-iofpht">render</code> function.</p></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><p class="css-1mv7wyt">We keep the part that creates a DOM node in its own function, we are going to use it later.</p></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><p class="css-1mv7wyt">In the <code class="css-iofpht">render</code> function we set <code class="css-iofpht">nextUnitOfWork</code> to the root of the fiber tree.</p></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><p class="css-1mv7wyt">Then, when the browser is ready,it will call our <code class="css-iofpht">workLoop</code> and we’ll start working on the root.</p></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><p class="css-1mv7wyt">First, we create a new node and append it to the DOM.</p><p class="css-1mv7wyt">We keep track of the DOM node in the <code class="css-iofpht">fiber.dom</code> property. </p></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><p class="css-1mv7wyt">Then for each child we create a new fiber.</p></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><p class="css-1mv7wyt">And we add it to the fiber tree setting it either as a child or as a sibling, depending on whether it’s the first child or not.</p></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><p class="css-1mv7wyt">Finally we search for the next unit of work.
We first try with the child, then with the sibling, then with the uncle, and so on.</p></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><p class="css-1mv7wyt">And that’s our <code class="css-iofpht">performUnitOfWork</code>.</p></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><h3 id="step-v-render-and-commit-phases" class="css-c39m66">Step V: Render and Commit Phases</h3><p class="css-1mv7wyt">We have another problem here.</p><p class="css-1mv7wyt">We are adding a new node to the DOM each time we work on an element.
And, remember, the browser could interrupt our work before we finish rendering the whole tree.
In that case, the user will see an incomplete UI. And we don’t want that.</p></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><p class="css-1mv7wyt">So we need to remove the part that mutates the DOM from here.</p></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><p class="css-1mv7wyt">Instead, we’ll keep track of the root of the fiber tree. We call it the work in progress root or <code class="css-iofpht">wipRoot</code>.</p></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><p class="css-1mv7wyt">And once we finish all the work (we know it because there isn’t a next unit of work) we commit the whole fiber tree to the DOM.</p></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><p class="css-1mv7wyt">We do it in the <code class="css-iofpht">commitRoot</code> function. Here we recursively append all the nodes to the dom.</p><h3 id="step-vi-reconciliation" class="css-c39m66">Step VI: Reconciliation</h3><p class="css-1mv7wyt">So far we only <em class="css-0">added</em> stuff to the DOM, but what about updating or deleting nodes?</p><p class="css-1mv7wyt">That’s what we are going to do now, we need to compare the elements we receive on the <code class="css-iofpht">render</code> function to the last fiber tree we committed to the DOM.</p></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><p class="css-1mv7wyt">So we need to save a reference to that “last fiber tree we committed to the DOM” after we finish the commit. We call it <code class="css-iofpht">currentRoot</code>.</p><p class="css-1mv7wyt">We also add the <code class="css-iofpht">alternate</code> property to every fiber. This property is a link to the old fiber, the fiber that we committed to the DOM in the previous commit phase.</p></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><p class="css-1mv7wyt">Now let’s extract the code from <code class="css-iofpht">performUnitOfWork</code> that creates the new fibers…</p></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><p class="css-1mv7wyt">…to a new <code class="css-iofpht">reconcileChildren</code> function.</p></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><p class="css-1mv7wyt">Here we will reconcile the old fibers with the new elements.</p></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><p class="css-1mv7wyt">We iterate at the same time over the children of the old fiber (<code class="css-iofpht">wipFiber.alternate</code>) and the array of elements we want to reconcile.</p><p class="css-1mv7wyt">If we ignore all the boilerplate needed to iterate over an array and a linked list at the same time, we are left with what matters most inside this while: <code class="css-iofpht">oldFiber</code> and <code class="css-iofpht">element</code>. <strong class="css-1vg6q84">The <code class="css-iofpht">element</code> is the thing we want to render to the DOM and the <code class="css-iofpht">oldFiber</code> is what we rendered the last time.</strong></p><p class="css-1mv7wyt">We need to compare them to see if there’s any change we need to apply to the DOM.</p></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><p class="css-1mv7wyt">To compare them we use the type:</p><ul class="css-wf0k3i"><li class="css-16s26jd"><p class="css-1mv7wyt">if the old fiber and the new element have the same type, we can keep the DOM node and just update it with the new props</p></li><li class="css-16s26jd"><p class="css-1mv7wyt">if the type is different and there is a new element, it means we need to create a new DOM node</p></li><li class="css-16s26jd"><p class="css-1mv7wyt">and if the types are different and there is an old fiber, we need to remove the old node</p></li></ul><p class="css-1mv7wyt"><em class="css-0">Here React also uses keys, that makes a better reconciliation. For example, it detects when children change places in the element array.</em></p></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><p class="css-1mv7wyt">When the old fiber and the element have the same type, we create a new fiber keeping the DOM node from the old fiber and the props from the element.</p><p class="css-1mv7wyt">We also add a new property to the fiber: the <code class="css-iofpht">effectTag</code>. We’ll use this property later, during the commit phase.</p></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><p class="css-1mv7wyt">Then for the case where the element needs a new DOM node we tag the new fiber with the <code class="css-iofpht">PLACEMENT</code> effect tag.</p></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><p class="css-1mv7wyt">And for the case where we need to delete the node, we don’t have a new fiber so we add the effect tag to the old fiber.</p><p class="css-1mv7wyt">But when we commit the fiber tree to the DOM we do it from the work in progress root, which doesn’t have the old fibers.</p></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><p class="css-1mv7wyt">So we need an array to keep track of the nodes we want to remove.</p></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><p class="css-1mv7wyt">And then, when we are commiting the changes to the DOM, we also use the fibers from that array.</p></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><p class="css-1mv7wyt">Now, let’s change the <code class="css-iofpht">commitWork</code> function to handle the new <code class="css-iofpht">effectTags</code>.</p></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><p class="css-1mv7wyt">If the fiber has a <code class="css-iofpht">PLACEMENT</code> effect tag we do the same as before, append the DOM node to the node from the parent fiber.</p></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><p class="css-1mv7wyt">If it’s a <code class="css-iofpht">DELETION</code>, we do the opposite, remove the child.</p></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><p class="css-1mv7wyt">And if it’s an <code class="css-iofpht">UPDATE</code>, we need to update the existing DOM node with the props that changed.</p></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><p class="css-1mv7wyt">We’ll do it in this <code class="css-iofpht">updateDom</code> function.</p></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><p class="css-1mv7wyt">We compare the props from the old fiber to the props of the new fiber, remove the props that are gone, and set the props that are new or changed.</p></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><p class="css-1mv7wyt">One special kind of prop that we need to update are event listeners, so if the prop name starts with the “on” prefix we’ll handle them differently.</p></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><p class="css-1mv7wyt">If the event handler changed we remove it from the node.</p></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><p class="css-1mv7wyt">And then we add the new handler.</p></div></div></div></div><p class="css-1mv7wyt">Try the version with reconciliation on <a href="https://codesandbox.io/s/didact-6-96533" class="css-1scict0">codesandbox</a>.</p><div class="css-1iq4mep"><div class="css-ovklbk"><div style="height:100%;width:100%"><div class="css-7yj60q"><div style="overflow:auto;height:100%;width:100%"><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-0"><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">createElement</span><span class="token-punctuation">(</span><span class="token-parameter">type</span><span class="token-punctuation">,</span><span class="token-parameter"> props</span><span class="token-punctuation">,</span><span class="token-parameter"> </span><span class="token-operator">...</span><span class="token-parameter">children</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-1"><span class="token-plain">  </span><span class="token-keyword">return</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-2"><span class="token-plain">    type</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-3"><span class="token-plain">    props</span><span class="token-operator">:</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-4"><span class="token-plain">      </span><span class="token-operator">...</span><span class="token-plain">props</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-5"><span class="token-plain">      children</span><span class="token-operator">:</span><span class="token-plain"> children</span><span class="token-punctuation">.</span><span class="token-function">map</span><span class="token-punctuation">(</span><span class="token-parameter">child</span><span class="token-plain"> </span><span class="token-operator">=&gt;</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-6"><span class="token-plain">        </span><span class="token-keyword">typeof</span><span class="token-plain"> child </span><span class="token-operator">===</span><span class="token-plain"> </span><span class="token-string">&quot;object&quot;</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-7"><span class="token-plain">          </span><span class="token-operator">?</span><span class="token-plain"> child</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-8"><span class="token-plain">          </span><span class="token-operator">:</span><span class="token-plain"> </span><span class="token-function">createTextElement</span><span class="token-punctuation">(</span><span class="token-plain">child</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-9"><span class="token-plain">      </span><span class="token-punctuation">)</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-10"><span class="token-plain">    </span><span class="token-punctuation">}</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-11"><span class="token-plain">  </span><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-13"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-14"><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">createTextElement</span><span class="token-punctuation">(</span><span class="token-parameter">text</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-15"><span class="token-plain">  </span><span class="token-keyword">return</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-16"><span class="token-plain">    type</span><span class="token-operator">:</span><span class="token-plain"> </span><span class="token-string">&quot;TEXT_ELEMENT&quot;</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-17"><span class="token-plain">    props</span><span class="token-operator">:</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-18"><span class="token-plain">      nodeValue</span><span class="token-operator">:</span><span class="token-plain"> text</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-19"><span class="token-plain">      children</span><span class="token-operator">:</span><span class="token-plain"> </span><span class="token-punctuation">[</span><span class="token-punctuation">]</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-20"><span class="token-plain">    </span><span class="token-punctuation">}</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-21"><span class="token-plain">  </span><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-22"><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-23"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-24"><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">createDom</span><span class="token-punctuation">(</span><span class="token-parameter">fiber</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-25"><span class="token-plain">  </span><span class="token-keyword">const</span><span class="token-plain"> dom </span><span class="token-operator">=</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-26"><span class="token-plain">    fiber</span><span class="token-punctuation">.</span><span class="token-plain">type </span><span class="token-operator">==</span><span class="token-plain"> </span><span class="token-string">&quot;TEXT_ELEMENT&quot;</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-27"><span class="token-plain">      </span><span class="token-operator">?</span><span class="token-plain"> document</span><span class="token-punctuation">.</span><span class="token-function">createTextNode</span><span class="token-punctuation">(</span><span class="token-string">&quot;&quot;</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-28"><span class="token-plain">      </span><span class="token-operator">:</span><span class="token-plain"> document</span><span class="token-punctuation">.</span><span class="token-function">createElement</span><span class="token-punctuation">(</span><span class="token-plain">fiber</span><span class="token-punctuation">.</span><span class="token-plain">type</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-29"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-30"><span class="token-plain">  </span><span class="token-function">updateDom</span><span class="token-punctuation">(</span><span class="token-plain">dom</span><span class="token-punctuation">,</span><span class="token-plain"> </span><span class="token-punctuation">{</span><span class="token-punctuation">}</span><span class="token-punctuation">,</span><span class="token-plain"> fiber</span><span class="token-punctuation">.</span><span class="token-plain">props</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-31"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-32"><span class="token-plain">  </span><span class="token-keyword">return</span><span class="token-plain"> dom</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-33"><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-34"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-35"><span class="token-keyword">const</span><span class="token-plain"> </span><span class="token-function-variable">isEvent</span><span class="token-plain"> </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-parameter">key</span><span class="token-plain"> </span><span class="token-operator">=&gt;</span><span class="token-plain"> key</span><span class="token-punctuation">.</span><span class="token-function">startsWith</span><span class="token-punctuation">(</span><span class="token-string">&quot;on&quot;</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-36"><span class="token-keyword">const</span><span class="token-plain"> </span><span class="token-function-variable">isProperty</span><span class="token-plain"> </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-parameter">key</span><span class="token-plain"> </span><span class="token-operator">=&gt;</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-37"><span class="token-plain">  key </span><span class="token-operator">!==</span><span class="token-plain"> </span><span class="token-string">&quot;children&quot;</span><span class="token-plain"> </span><span class="token-operator">&amp;&amp;</span><span class="token-plain"> </span><span class="token-operator">!</span><span class="token-function">isEvent</span><span class="token-punctuation">(</span><span class="token-plain">key</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-38"><span class="token-keyword">const</span><span class="token-plain"> </span><span class="token-function-variable">isNew</span><span class="token-plain"> </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-punctuation">(</span><span class="token-parameter">prev</span><span class="token-punctuation">,</span><span class="token-parameter"> next</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-operator">=&gt;</span><span class="token-plain"> </span><span class="token-parameter">key</span><span class="token-plain"> </span><span class="token-operator">=&gt;</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-39"><span class="token-plain">  prev</span><span class="token-punctuation">[</span><span class="token-plain">key</span><span class="token-punctuation">]</span><span class="token-plain"> </span><span class="token-operator">!==</span><span class="token-plain"> next</span><span class="token-punctuation">[</span><span class="token-plain">key</span><span class="token-punctuation">]</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-40"><span class="token-keyword">const</span><span class="token-plain"> </span><span class="token-function-variable">isGone</span><span class="token-plain"> </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-punctuation">(</span><span class="token-parameter">prev</span><span class="token-punctuation">,</span><span class="token-parameter"> next</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-operator">=&gt;</span><span class="token-plain"> </span><span class="token-parameter">key</span><span class="token-plain"> </span><span class="token-operator">=&gt;</span><span class="token-plain"> </span><span class="token-operator">!</span><span class="token-punctuation">(</span><span class="token-plain">key </span><span class="token-keyword">in</span><span class="token-plain"> next</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-41"><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">updateDom</span><span class="token-punctuation">(</span><span class="token-parameter">dom</span><span class="token-punctuation">,</span><span class="token-parameter"> prevProps</span><span class="token-punctuation">,</span><span class="token-parameter"> nextProps</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-42"><span class="token-plain">  </span><span class="token-comment">//Remove old or changed event listeners</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-43"><span class="token-plain">  Object</span><span class="token-punctuation">.</span><span class="token-function">keys</span><span class="token-punctuation">(</span><span class="token-plain">prevProps</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-44"><span class="token-plain">    </span><span class="token-punctuation">.</span><span class="token-function">filter</span><span class="token-punctuation">(</span><span class="token-plain">isEvent</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-45"><span class="token-plain">    </span><span class="token-punctuation">.</span><span class="token-function">filter</span><span class="token-punctuation">(</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-46"><span class="token-plain">      </span><span class="token-parameter">key</span><span class="token-plain"> </span><span class="token-operator">=&gt;</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-47"><span class="token-plain">        </span><span class="token-operator">!</span><span class="token-punctuation">(</span><span class="token-plain">key </span><span class="token-keyword">in</span><span class="token-plain"> nextProps</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-operator">||</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-48"><span class="token-plain">        </span><span class="token-function">isNew</span><span class="token-punctuation">(</span><span class="token-plain">prevProps</span><span class="token-punctuation">,</span><span class="token-plain"> nextProps</span><span class="token-punctuation">)</span><span class="token-punctuation">(</span><span class="token-plain">key</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-49"><span class="token-plain">    </span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-50"><span class="token-plain">    </span><span class="token-punctuation">.</span><span class="token-function">forEach</span><span class="token-punctuation">(</span><span class="token-parameter">name</span><span class="token-plain"> </span><span class="token-operator">=&gt;</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-51"><span class="token-plain">      </span><span class="token-keyword">const</span><span class="token-plain"> eventType </span><span class="token-operator">=</span><span class="token-plain"> name</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-52"><span class="token-plain">        </span><span class="token-punctuation">.</span><span class="token-function">toLowerCase</span><span class="token-punctuation">(</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-53"><span class="token-plain">        </span><span class="token-punctuation">.</span><span class="token-function">substring</span><span class="token-punctuation">(</span><span class="token-number">2</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-54"><span class="token-plain">      dom</span><span class="token-punctuation">.</span><span class="token-function">removeEventListener</span><span class="token-punctuation">(</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-55"><span class="token-plain">        eventType</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-56"><span class="token-plain">        prevProps</span><span class="token-punctuation">[</span><span class="token-plain">name</span><span class="token-punctuation">]</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-57"><span class="token-plain">      </span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-58"><span class="token-plain">    </span><span class="token-punctuation">}</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-59"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-60"><span class="token-plain">  </span><span class="token-comment">// Remove old properties</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-61"><span class="token-plain">  Object</span><span class="token-punctuation">.</span><span class="token-function">keys</span><span class="token-punctuation">(</span><span class="token-plain">prevProps</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-62"><span class="token-plain">    </span><span class="token-punctuation">.</span><span class="token-function">filter</span><span class="token-punctuation">(</span><span class="token-plain">isProperty</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-63"><span class="token-plain">    </span><span class="token-punctuation">.</span><span class="token-function">filter</span><span class="token-punctuation">(</span><span class="token-function">isGone</span><span class="token-punctuation">(</span><span class="token-plain">prevProps</span><span class="token-punctuation">,</span><span class="token-plain"> nextProps</span><span class="token-punctuation">)</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-64"><span class="token-plain">    </span><span class="token-punctuation">.</span><span class="token-function">forEach</span><span class="token-punctuation">(</span><span class="token-parameter">name</span><span class="token-plain"> </span><span class="token-operator">=&gt;</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-65"><span class="token-plain">      dom</span><span class="token-punctuation">[</span><span class="token-plain">name</span><span class="token-punctuation">]</span><span class="token-plain"> </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-string">&quot;&quot;</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-66"><span class="token-plain">    </span><span class="token-punctuation">}</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-67"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-68"><span class="token-plain">  </span><span class="token-comment">// Set new or changed properties</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-69"><span class="token-plain">  Object</span><span class="token-punctuation">.</span><span class="token-function">keys</span><span class="token-punctuation">(</span><span class="token-plain">nextProps</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-70"><span class="token-plain">    </span><span class="token-punctuation">.</span><span class="token-function">filter</span><span class="token-punctuation">(</span><span class="token-plain">isProperty</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-71"><span class="token-plain">    </span><span class="token-punctuation">.</span><span class="token-function">filter</span><span class="token-punctuation">(</span><span class="token-function">isNew</span><span class="token-punctuation">(</span><span class="token-plain">prevProps</span><span class="token-punctuation">,</span><span class="token-plain"> nextProps</span><span class="token-punctuation">)</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-72"><span class="token-plain">    </span><span class="token-punctuation">.</span><span class="token-function">forEach</span><span class="token-punctuation">(</span><span class="token-parameter">name</span><span class="token-plain"> </span><span class="token-operator">=&gt;</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-73"><span class="token-plain">      dom</span><span class="token-punctuation">[</span><span class="token-plain">name</span><span class="token-punctuation">]</span><span class="token-plain"> </span><span class="token-operator">=</span><span class="token-plain"> nextProps</span><span class="token-punctuation">[</span><span class="token-plain">name</span><span class="token-punctuation">]</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-74"><span class="token-plain">    </span><span class="token-punctuation">}</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-75"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-76"><span class="token-plain">  </span><span class="token-comment">// Add event listeners</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-77"><span class="token-plain">  Object</span><span class="token-punctuation">.</span><span class="token-function">keys</span><span class="token-punctuation">(</span><span class="token-plain">nextProps</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-78"><span class="token-plain">    </span><span class="token-punctuation">.</span><span class="token-function">filter</span><span class="token-punctuation">(</span><span class="token-plain">isEvent</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-79"><span class="token-plain">    </span><span class="token-punctuation">.</span><span class="token-function">filter</span><span class="token-punctuation">(</span><span class="token-function">isNew</span><span class="token-punctuation">(</span><span class="token-plain">prevProps</span><span class="token-punctuation">,</span><span class="token-plain"> nextProps</span><span class="token-punctuation">)</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-80"><span class="token-plain">    </span><span class="token-punctuation">.</span><span class="token-function">forEach</span><span class="token-punctuation">(</span><span class="token-parameter">name</span><span class="token-plain"> </span><span class="token-operator">=&gt;</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-81"><span class="token-plain">      </span><span class="token-keyword">const</span><span class="token-plain"> eventType </span><span class="token-operator">=</span><span class="token-plain"> name</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-82"><span class="token-plain">        </span><span class="token-punctuation">.</span><span class="token-function">toLowerCase</span><span class="token-punctuation">(</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-83"><span class="token-plain">        </span><span class="token-punctuation">.</span><span class="token-function">substring</span><span class="token-punctuation">(</span><span class="token-number">2</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-84"><span class="token-plain">      dom</span><span class="token-punctuation">.</span><span class="token-function">addEventListener</span><span class="token-punctuation">(</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-85"><span class="token-plain">        eventType</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-86"><span class="token-plain">        nextProps</span><span class="token-punctuation">[</span><span class="token-plain">name</span><span class="token-punctuation">]</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-87"><span class="token-plain">      </span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-88"><span class="token-plain">    </span><span class="token-punctuation">}</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-89"><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-90"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-91"><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">commitRoot</span><span class="token-punctuation">(</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-92"><span class="token-plain">  deletions</span><span class="token-punctuation">.</span><span class="token-function">forEach</span><span class="token-punctuation">(</span><span class="token-plain">commitWork</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-93"><span class="token-plain">  </span><span class="token-function">commitWork</span><span class="token-punctuation">(</span><span class="token-plain">wipRoot</span><span class="token-punctuation">.</span><span class="token-plain">child</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-94"><span class="token-plain">  currentRoot </span><span class="token-operator">=</span><span class="token-plain"> wipRoot</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-95"><span class="token-plain">  wipRoot </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-keyword">null</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-96"><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-97"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-98"><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">commitWork</span><span class="token-punctuation">(</span><span class="token-parameter">fiber</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-99"><span class="token-plain">  </span><span class="token-keyword">if</span><span class="token-plain"> </span><span class="token-punctuation">(</span><span class="token-operator">!</span><span class="token-plain">fiber</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-100"><span class="token-plain">    </span><span class="token-keyword">return</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-101"><span class="token-plain">  </span><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-102"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-109"><span class="token-plain">  </span><span class="token-keyword">const</span><span class="token-plain"> domParent </span><span class="token-operator">=</span><span class="token-plain"> fiber</span><span class="token-punctuation">.</span><span class="token-plain">parent</span><span class="token-punctuation">.</span><span class="token-plain">dom</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-110"><span class="token-plain">  </span><span class="token-keyword">if</span><span class="token-plain"> </span><span class="token-punctuation">(</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-111"><span class="token-plain">    fiber</span><span class="token-punctuation">.</span><span class="token-plain">effectTag </span><span class="token-operator">===</span><span class="token-plain"> </span><span class="token-string">&quot;PLACEMENT&quot;</span><span class="token-plain"> </span><span class="token-operator">&amp;&amp;</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-112"><span class="token-plain">    fiber</span><span class="token-punctuation">.</span><span class="token-plain">dom </span><span class="token-operator">!=</span><span class="token-plain"> </span><span class="token-keyword">null</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-113"><span class="token-plain">  </span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-114"><span class="token-plain">    domParent</span><span class="token-punctuation">.</span><span class="token-function">appendChild</span><span class="token-punctuation">(</span><span class="token-plain">fiber</span><span class="token-punctuation">.</span><span class="token-plain">dom</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-115"><span class="token-plain">  </span><span class="token-punctuation">}</span><span class="token-plain"> </span><span class="token-keyword">else</span><span class="token-plain"> </span><span class="token-keyword">if</span><span class="token-plain"> </span><span class="token-punctuation">(</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-116"><span class="token-plain">    fiber</span><span class="token-punctuation">.</span><span class="token-plain">effectTag </span><span class="token-operator">===</span><span class="token-plain"> </span><span class="token-string">&quot;UPDATE&quot;</span><span class="token-plain"> </span><span class="token-operator">&amp;&amp;</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-117"><span class="token-plain">    fiber</span><span class="token-punctuation">.</span><span class="token-plain">dom </span><span class="token-operator">!=</span><span class="token-plain"> </span><span class="token-keyword">null</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-118"><span class="token-plain">  </span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-119"><span class="token-plain">    </span><span class="token-function">updateDom</span><span class="token-punctuation">(</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-120"><span class="token-plain">      fiber</span><span class="token-punctuation">.</span><span class="token-plain">dom</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-121"><span class="token-plain">      fiber</span><span class="token-punctuation">.</span><span class="token-plain">alternate</span><span class="token-punctuation">.</span><span class="token-plain">props</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-122"><span class="token-plain">      fiber</span><span class="token-punctuation">.</span><span class="token-plain">props</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-123"><span class="token-plain">    </span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-124"><span class="token-plain">  </span><span class="token-punctuation">}</span><span class="token-plain"> </span><span class="token-keyword">else</span><span class="token-plain"> </span><span class="token-keyword">if</span><span class="token-plain"> </span><span class="token-punctuation">(</span><span class="token-plain">fiber</span><span class="token-punctuation">.</span><span class="token-plain">effectTag </span><span class="token-operator">===</span><span class="token-plain"> </span><span class="token-string">&quot;DELETION&quot;</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-126"><span class="token-plain">    domParent</span><span class="token-punctuation">.</span><span class="token-function">removeChild</span><span class="token-punctuation">(</span><span class="token-plain">fiber</span><span class="token-punctuation">.</span><span class="token-plain">dom</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-127"><span class="token-plain">  </span><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-128"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-129"><span class="token-plain">  </span><span class="token-function">commitWork</span><span class="token-punctuation">(</span><span class="token-plain">fiber</span><span class="token-punctuation">.</span><span class="token-plain">child</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-130"><span class="token-plain">  </span><span class="token-function">commitWork</span><span class="token-punctuation">(</span><span class="token-plain">fiber</span><span class="token-punctuation">.</span><span class="token-plain">sibling</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-131"><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-132"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-141"><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">render</span><span class="token-punctuation">(</span><span class="token-parameter">element</span><span class="token-punctuation">,</span><span class="token-parameter"> container</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-142"><span class="token-plain">  wipRoot </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-143"><span class="token-plain">    dom</span><span class="token-operator">:</span><span class="token-plain"> container</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-144"><span class="token-plain">    props</span><span class="token-operator">:</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-145"><span class="token-plain">      children</span><span class="token-operator">:</span><span class="token-plain"> </span><span class="token-punctuation">[</span><span class="token-plain">element</span><span class="token-punctuation">]</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-146"><span class="token-plain">    </span><span class="token-punctuation">}</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-147"><span class="token-plain">    alternate</span><span class="token-operator">:</span><span class="token-plain"> currentRoot</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-148"><span class="token-plain">  </span><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-149"><span class="token-plain">  deletions </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-punctuation">[</span><span class="token-punctuation">]</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-150"><span class="token-plain">  nextUnitOfWork </span><span class="token-operator">=</span><span class="token-plain"> wipRoot</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-151"><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-152"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-153"><span class="token-keyword">let</span><span class="token-plain"> nextUnitOfWork </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-keyword">null</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-154"><span class="token-keyword">let</span><span class="token-plain"> currentRoot </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-keyword">null</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-155"><span class="token-keyword">let</span><span class="token-plain"> wipRoot </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-keyword">null</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-156"><span class="token-keyword">let</span><span class="token-plain"> deletions </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-keyword">null</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-157"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-158"><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">workLoop</span><span class="token-punctuation">(</span><span class="token-parameter">deadline</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-159"><span class="token-plain">  </span><span class="token-keyword">let</span><span class="token-plain"> shouldYield </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-boolean">false</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-160"><span class="token-plain">  </span><span class="token-keyword">while</span><span class="token-plain"> </span><span class="token-punctuation">(</span><span class="token-plain">nextUnitOfWork </span><span class="token-operator">&amp;&amp;</span><span class="token-plain"> </span><span class="token-operator">!</span><span class="token-plain">shouldYield</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-161"><span class="token-plain">    nextUnitOfWork </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-function">performUnitOfWork</span><span class="token-punctuation">(</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-162"><span class="token-plain">      nextUnitOfWork</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-163"><span class="token-plain">    </span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-164"><span class="token-plain">    shouldYield </span><span class="token-operator">=</span><span class="token-plain"> deadline</span><span class="token-punctuation">.</span><span class="token-function">timeRemaining</span><span class="token-punctuation">(</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-operator">&lt;</span><span class="token-plain"> </span><span class="token-number">1</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-165"><span class="token-plain">  </span><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-166"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-167"><span class="token-plain">  </span><span class="token-keyword">if</span><span class="token-plain"> </span><span class="token-punctuation">(</span><span class="token-operator">!</span><span class="token-plain">nextUnitOfWork </span><span class="token-operator">&amp;&amp;</span><span class="token-plain"> wipRoot</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-168"><span class="token-plain">    </span><span class="token-function">commitRoot</span><span class="token-punctuation">(</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-169"><span class="token-plain">  </span><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-170"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-171"><span class="token-plain">  </span><span class="token-function">requestIdleCallback</span><span class="token-punctuation">(</span><span class="token-plain">workLoop</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-172"><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-173"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-174"><span class="token-function">requestIdleCallback</span><span class="token-punctuation">(</span><span class="token-plain">workLoop</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-175"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-176"><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">performUnitOfWork</span><span class="token-punctuation">(</span><span class="token-parameter">fiber</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-183"><span class="token-plain">  </span><span class="token-keyword">if</span><span class="token-plain"> </span><span class="token-punctuation">(</span><span class="token-operator">!</span><span class="token-plain">fiber</span><span class="token-punctuation">.</span><span class="token-plain">dom</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-184"><span class="token-plain">    fiber</span><span class="token-punctuation">.</span><span class="token-plain">dom </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-function">createDom</span><span class="token-punctuation">(</span><span class="token-plain">fiber</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-185"><span class="token-plain">  </span><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-186"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-187"><span class="token-plain">  </span><span class="token-keyword">const</span><span class="token-plain"> elements </span><span class="token-operator">=</span><span class="token-plain"> fiber</span><span class="token-punctuation">.</span><span class="token-plain">props</span><span class="token-punctuation">.</span><span class="token-plain">children</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-188"><span class="token-plain">  </span><span class="token-function">reconcileChildren</span><span class="token-punctuation">(</span><span class="token-plain">fiber</span><span class="token-punctuation">,</span><span class="token-plain"> elements</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-189"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-190"><span class="token-plain">  </span><span class="token-keyword">if</span><span class="token-plain"> </span><span class="token-punctuation">(</span><span class="token-plain">fiber</span><span class="token-punctuation">.</span><span class="token-plain">child</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-191"><span class="token-plain">    </span><span class="token-keyword">return</span><span class="token-plain"> fiber</span><span class="token-punctuation">.</span><span class="token-plain">child</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-192"><span class="token-plain">  </span><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-193"><span class="token-plain">  </span><span class="token-keyword">let</span><span class="token-plain"> nextFiber </span><span class="token-operator">=</span><span class="token-plain"> fiber</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-194"><span class="token-plain">  </span><span class="token-keyword">while</span><span class="token-plain"> </span><span class="token-punctuation">(</span><span class="token-plain">nextFiber</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-195"><span class="token-plain">    </span><span class="token-keyword">if</span><span class="token-plain"> </span><span class="token-punctuation">(</span><span class="token-plain">nextFiber</span><span class="token-punctuation">.</span><span class="token-plain">sibling</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-196"><span class="token-plain">      </span><span class="token-keyword">return</span><span class="token-plain"> nextFiber</span><span class="token-punctuation">.</span><span class="token-plain">sibling</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-197"><span class="token-plain">    </span><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-198"><span class="token-plain">    nextFiber </span><span class="token-operator">=</span><span class="token-plain"> nextFiber</span><span class="token-punctuation">.</span><span class="token-plain">parent</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-199"><span class="token-plain">  </span><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-200"><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-201"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-254"><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">reconcileChildren</span><span class="token-punctuation">(</span><span class="token-parameter">wipFiber</span><span class="token-punctuation">,</span><span class="token-parameter"> elements</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-255"><span class="token-plain">  </span><span class="token-keyword">let</span><span class="token-plain"> index </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-number">0</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-256"><span class="token-plain">  </span><span class="token-keyword">let</span><span class="token-plain"> oldFiber </span><span class="token-operator">=</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-257"><span class="token-plain">    wipFiber</span><span class="token-punctuation">.</span><span class="token-plain">alternate </span><span class="token-operator">&amp;&amp;</span><span class="token-plain"> wipFiber</span><span class="token-punctuation">.</span><span class="token-plain">alternate</span><span class="token-punctuation">.</span><span class="token-plain">child</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-258"><span class="token-plain">  </span><span class="token-keyword">let</span><span class="token-plain"> prevSibling </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-keyword">null</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-259"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-260"><span class="token-plain">  </span><span class="token-keyword">while</span><span class="token-plain"> </span><span class="token-punctuation">(</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-261"><span class="token-plain">    index </span><span class="token-operator">&lt;</span><span class="token-plain"> elements</span><span class="token-punctuation">.</span><span class="token-plain">length </span><span class="token-operator">||</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-262"><span class="token-plain">    oldFiber </span><span class="token-operator">!=</span><span class="token-plain"> </span><span class="token-keyword">null</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-263"><span class="token-plain">  </span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-264"><span class="token-plain">    </span><span class="token-keyword">const</span><span class="token-plain"> element </span><span class="token-operator">=</span><span class="token-plain"> elements</span><span class="token-punctuation">[</span><span class="token-plain">index</span><span class="token-punctuation">]</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-265"><span class="token-plain">    </span><span class="token-keyword">let</span><span class="token-plain"> newFiber </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-keyword">null</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-266"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-267"><span class="token-plain">    </span><span class="token-keyword">const</span><span class="token-plain"> sameType </span><span class="token-operator">=</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-268"><span class="token-plain">      oldFiber </span><span class="token-operator">&amp;&amp;</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-269"><span class="token-plain">      element </span><span class="token-operator">&amp;&amp;</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-270"><span class="token-plain">      element</span><span class="token-punctuation">.</span><span class="token-plain">type </span><span class="token-operator">==</span><span class="token-plain"> oldFiber</span><span class="token-punctuation">.</span><span class="token-plain">type</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-271"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-272"><span class="token-plain">    </span><span class="token-keyword">if</span><span class="token-plain"> </span><span class="token-punctuation">(</span><span class="token-plain">sameType</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-273"><span class="token-plain">      newFiber </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-274"><span class="token-plain">        type</span><span class="token-operator">:</span><span class="token-plain"> oldFiber</span><span class="token-punctuation">.</span><span class="token-plain">type</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-275"><span class="token-plain">        props</span><span class="token-operator">:</span><span class="token-plain"> element</span><span class="token-punctuation">.</span><span class="token-plain">props</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-276"><span class="token-plain">        dom</span><span class="token-operator">:</span><span class="token-plain"> oldFiber</span><span class="token-punctuation">.</span><span class="token-plain">dom</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-277"><span class="token-plain">        parent</span><span class="token-operator">:</span><span class="token-plain"> wipFiber</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-278"><span class="token-plain">        alternate</span><span class="token-operator">:</span><span class="token-plain"> oldFiber</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-279"><span class="token-plain">        effectTag</span><span class="token-operator">:</span><span class="token-plain"> </span><span class="token-string">&quot;UPDATE&quot;</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-280"><span class="token-plain">      </span><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-281"><span class="token-plain">    </span><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-282"><span class="token-plain">    </span><span class="token-keyword">if</span><span class="token-plain"> </span><span class="token-punctuation">(</span><span class="token-plain">element </span><span class="token-operator">&amp;&amp;</span><span class="token-plain"> </span><span class="token-operator">!</span><span class="token-plain">sameType</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-283"><span class="token-plain">      newFiber </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-284"><span class="token-plain">        type</span><span class="token-operator">:</span><span class="token-plain"> element</span><span class="token-punctuation">.</span><span class="token-plain">type</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-285"><span class="token-plain">        props</span><span class="token-operator">:</span><span class="token-plain"> element</span><span class="token-punctuation">.</span><span class="token-plain">props</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-286"><span class="token-plain">        dom</span><span class="token-operator">:</span><span class="token-plain"> </span><span class="token-keyword">null</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-287"><span class="token-plain">        parent</span><span class="token-operator">:</span><span class="token-plain"> wipFiber</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-288"><span class="token-plain">        alternate</span><span class="token-operator">:</span><span class="token-plain"> </span><span class="token-keyword">null</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-289"><span class="token-plain">        effectTag</span><span class="token-operator">:</span><span class="token-plain"> </span><span class="token-string">&quot;PLACEMENT&quot;</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-290"><span class="token-plain">      </span><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-291"><span class="token-plain">    </span><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-292"><span class="token-plain">    </span><span class="token-keyword">if</span><span class="token-plain"> </span><span class="token-punctuation">(</span><span class="token-plain">oldFiber </span><span class="token-operator">&amp;&amp;</span><span class="token-plain"> </span><span class="token-operator">!</span><span class="token-plain">sameType</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-293"><span class="token-plain">      oldFiber</span><span class="token-punctuation">.</span><span class="token-plain">effectTag </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-string">&quot;DELETION&quot;</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-294"><span class="token-plain">      deletions</span><span class="token-punctuation">.</span><span class="token-function">push</span><span class="token-punctuation">(</span><span class="token-plain">oldFiber</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-295"><span class="token-plain">    </span><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-296"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-297"><span class="token-plain">    </span><span class="token-keyword">if</span><span class="token-plain"> </span><span class="token-punctuation">(</span><span class="token-plain">oldFiber</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-298"><span class="token-plain">      oldFiber </span><span class="token-operator">=</span><span class="token-plain"> oldFiber</span><span class="token-punctuation">.</span><span class="token-plain">sibling</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-299"><span class="token-plain">    </span><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-300"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-301"><span class="token-plain">    </span><span class="token-keyword">if</span><span class="token-plain"> </span><span class="token-punctuation">(</span><span class="token-plain">index </span><span class="token-operator">===</span><span class="token-plain"> </span><span class="token-number">0</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-302"><span class="token-plain">      wipFiber</span><span class="token-punctuation">.</span><span class="token-plain">child </span><span class="token-operator">=</span><span class="token-plain"> newFiber</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-303"><span class="token-plain">    </span><span class="token-punctuation">}</span><span class="token-plain"> </span><span class="token-keyword">else</span><span class="token-plain"> </span><span class="token-keyword">if</span><span class="token-plain"> </span><span class="token-punctuation">(</span><span class="token-plain">element</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-304"><span class="token-plain">      prevSibling</span><span class="token-punctuation">.</span><span class="token-plain">sibling </span><span class="token-operator">=</span><span class="token-plain"> newFiber</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-305"><span class="token-plain">    </span><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-306"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-307"><span class="token-plain">    prevSibling </span><span class="token-operator">=</span><span class="token-plain"> newFiber</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-308"><span class="token-plain">    index</span><span class="token-operator">++</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-309"><span class="token-plain">  </span><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-310"><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-311"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-312"><span class="token-keyword">const</span><span class="token-plain"> Didact </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-313"><span class="token-plain">  createElement</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-314"><span class="token-plain">  render</span><span class="token-punctuation">,</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-316"><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:0.3;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-317"><span class="token-plain">​</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-318"><span class="token-comment">/** @jsx Didact.createElement */</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-326"><span class="token-keyword">function</span><span class="token-plain"> </span><span class="token-function">App</span><span class="token-punctuation">(</span><span class="token-parameter">props</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-punctuation">{</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-327"><span class="token-plain">  </span><span class="token-keyword">return</span><span class="token-plain"> </span><span class="token-punctuation">&lt;</span><span class="token-tag">h1</span><span class="token-punctuation">&gt;</span><span class="token-plain">Hi </span><span class="token-punctuation">{</span><span class="token-plain">props</span><span class="token-punctuation">.</span><span class="token-plain">name</span><span class="token-punctuation">}</span><span class="token-punctuation">&lt;/</span><span class="token-tag">h1</span><span class="token-punctuation">&gt;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-328"><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-330"><span class="token-keyword">const</span><span class="token-plain"> element </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-punctuation">&lt;</span><span class="token-class-name">App</span><span class="token-tag"> </span><span class="token-attr-name">name</span><span class="token-punctuation">=</span><span class="token-punctuation">&quot;</span><span class="token-attr-value">foo</span><span class="token-punctuation">&quot;</span><span class="token-tag"> </span><span class="token-punctuation">/&gt;</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-331"><span class="token-keyword">const</span><span class="token-plain"> container </span><span class="token-operator">=</span><span class="token-plain"> document</span><span class="token-punctuation">.</span><span class="token-function">getElementById</span><span class="token-punctuation">(</span><span class="token-string">&quot;root&quot;</span><span class="token-punctuation">)</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-332"><span class="token-plain">Didact</span><span class="token-punctuation">.</span><span class="token-function">render</span><span class="token-punctuation">(</span><span class="token-plain">element</span><span class="token-punctuation">,</span><span class="token-plain"> container</span><span class="token-punctuation">)</span></div></div><div></div></code></pre></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-40"><span class="token-keyword">const</span><span class="token-plain"> </span><span class="token-function-variable">isGone</span><span class="token-plain"> </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-punctuation">(</span><span class="token-parameter">prev</span><span class="token-punctuation">,</span><span class="token-parameter"> next</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-operator">=&gt;</span><span class="token-plain"> </span><span class="token-parameter">key</span><span class="token-plain"> </span><span class="token-operator">=&gt;</span><span class="token-plain"> </span><span class="token-operator">!</span><span class="token-punctuation">(</span><span class="token-plain">key </span><span class="token-keyword">in</span><span class="token-plain"> next</span><span class="token-punctuation">)</span></div></div><div></div></code></pre></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-40"><span class="token-keyword">const</span><span class="token-plain"> </span><span class="token-function-variable">isGone</span><span class="token-plain"> </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-punctuation">(</span><span class="token-parameter">prev</span><span class="token-punctuation">,</span><span class="token-parameter"> next</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-operator">=&gt;</span><span class="token-plain"> </span><span class="token-parameter">key</span><span class="token-plain"> </span><span class="token-operator">=&gt;</span><span class="token-plain"> </span><span class="token-operator">!</span><span class="token-punctuation">(</span><span class="token-plain">key </span><span class="token-keyword">in</span><span class="token-plain"> next</span><span class="token-punctuation">)</span></div></div><div></div></code></pre></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-40"><span class="token-keyword">const</span><span class="token-plain"> </span><span class="token-function-variable">isGone</span><span class="token-plain"> </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-punctuation">(</span><span class="token-parameter">prev</span><span class="token-punctuation">,</span><span class="token-parameter"> next</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-operator">=&gt;</span><span class="token-plain"> </span><span class="token-parameter">key</span><span class="token-plain"> </span><span class="token-operator">=&gt;</span><span class="token-plain"> </span><span class="token-operator">!</span><span class="token-punctuation">(</span><span class="token-plain">key </span><span class="token-keyword">in</span><span class="token-plain"> next</span><span class="token-punctuation">)</span></div></div><div></div></code></pre></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-40"><span class="token-keyword">const</span><span class="token-plain"> </span><span class="token-function-variable">isGone</span><span class="token-plain"> </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-punctuation">(</span><span class="token-parameter">prev</span><span class="token-punctuation">,</span><span class="token-parameter"> next</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-operator">=&gt;</span><span class="token-plain"> </span><span class="token-parameter">key</span><span class="token-plain"> </span><span class="token-operator">=&gt;</span><span class="token-plain"> </span><span class="token-operator">!</span><span class="token-punctuation">(</span><span class="token-plain">key </span><span class="token-keyword">in</span><span class="token-plain"> next</span><span class="token-punctuation">)</span></div></div><div></div></code></pre></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-40"><span class="token-keyword">const</span><span class="token-plain"> </span><span class="token-function-variable">isGone</span><span class="token-plain"> </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-punctuation">(</span><span class="token-parameter">prev</span><span class="token-punctuation">,</span><span class="token-parameter"> next</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-operator">=&gt;</span><span class="token-plain"> </span><span class="token-parameter">key</span><span class="token-plain"> </span><span class="token-operator">=&gt;</span><span class="token-plain"> </span><span class="token-operator">!</span><span class="token-punctuation">(</span><span class="token-plain">key </span><span class="token-keyword">in</span><span class="token-plain"> next</span><span class="token-punctuation">)</span></div></div><div></div></code></pre></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-40"><span class="token-keyword">const</span><span class="token-plain"> </span><span class="token-function-variable">isGone</span><span class="token-plain"> </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-punctuation">(</span><span class="token-parameter">prev</span><span class="token-punctuation">,</span><span class="token-parameter"> next</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-operator">=&gt;</span><span class="token-plain"> </span><span class="token-parameter">key</span><span class="token-plain"> </span><span class="token-operator">=&gt;</span><span class="token-plain"> </span><span class="token-operator">!</span><span class="token-punctuation">(</span><span class="token-plain">key </span><span class="token-keyword">in</span><span class="token-plain"> next</span><span class="token-punctuation">)</span></div></div><div></div></code></pre></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:1"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-40"><span class="token-keyword">const</span><span class="token-plain"> </span><span class="token-function-variable">isGone</span><span class="token-plain"> </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-punctuation">(</span><span class="token-parameter">prev</span><span class="token-punctuation">,</span><span class="token-parameter"> next</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-operator">=&gt;</span><span class="token-plain"> </span><span class="token-parameter">key</span><span class="token-plain"> </span><span class="token-operator">=&gt;</span><span class="token-plain"> </span><span class="token-operator">!</span><span class="token-punctuation">(</span><span class="token-plain">key </span><span class="token-keyword">in</span><span class="token-plain"> next</span><span class="token-punctuation">)</span></div></div><div></div></code></pre></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-40"><span class="token-keyword">const</span><span class="token-plain"> </span><span class="token-function-variable">isGone</span><span class="token-plain"> </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-punctuation">(</span><span class="token-parameter">prev</span><span class="token-punctuation">,</span><span class="token-parameter"> next</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-operator">=&gt;</span><span class="token-plain"> </span><span class="token-parameter">key</span><span class="token-plain"> </span><span class="token-operator">=&gt;</span><span class="token-plain"> </span><span class="token-operator">!</span><span class="token-punctuation">(</span><span class="token-plain">key </span><span class="token-keyword">in</span><span class="token-plain"> next</span><span class="token-punctuation">)</span></div></div><div></div></code></pre></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-40"><span class="token-keyword">const</span><span class="token-plain"> </span><span class="token-function-variable">isGone</span><span class="token-plain"> </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-punctuation">(</span><span class="token-parameter">prev</span><span class="token-punctuation">,</span><span class="token-parameter"> next</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-operator">=&gt;</span><span class="token-plain"> </span><span class="token-parameter">key</span><span class="token-plain"> </span><span class="token-operator">=&gt;</span><span class="token-plain"> </span><span class="token-operator">!</span><span class="token-punctuation">(</span><span class="token-plain">key </span><span class="token-keyword">in</span><span class="token-plain"> next</span><span class="token-punctuation">)</span></div></div><div></div></code></pre></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-40"><span class="token-keyword">const</span><span class="token-plain"> </span><span class="token-function-variable">isGone</span><span class="token-plain"> </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-punctuation">(</span><span class="token-parameter">prev</span><span class="token-punctuation">,</span><span class="token-parameter"> next</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-operator">=&gt;</span><span class="token-plain"> </span><span class="token-parameter">key</span><span class="token-plain"> </span><span class="token-operator">=&gt;</span><span class="token-plain"> </span><span class="token-operator">!</span><span class="token-punctuation">(</span><span class="token-plain">key </span><span class="token-keyword">in</span><span class="token-plain"> next</span><span class="token-punctuation">)</span></div></div><div></div></code></pre></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-40"><span class="token-keyword">const</span><span class="token-plain"> </span><span class="token-function-variable">isGone</span><span class="token-plain"> </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-punctuation">(</span><span class="token-parameter">prev</span><span class="token-punctuation">,</span><span class="token-parameter"> next</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-operator">=&gt;</span><span class="token-plain"> </span><span class="token-parameter">key</span><span class="token-plain"> </span><span class="token-operator">=&gt;</span><span class="token-plain"> </span><span class="token-operator">!</span><span class="token-punctuation">(</span><span class="token-plain">key </span><span class="token-keyword">in</span><span class="token-plain"> next</span><span class="token-punctuation">)</span></div></div><div></div></code></pre></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-40"><span class="token-keyword">const</span><span class="token-plain"> </span><span class="token-function-variable">isGone</span><span class="token-plain"> </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-punctuation">(</span><span class="token-parameter">prev</span><span class="token-punctuation">,</span><span class="token-parameter"> next</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-operator">=&gt;</span><span class="token-plain"> </span><span class="token-parameter">key</span><span class="token-plain"> </span><span class="token-operator">=&gt;</span><span class="token-plain"> </span><span class="token-operator">!</span><span class="token-punctuation">(</span><span class="token-plain">key </span><span class="token-keyword">in</span><span class="token-plain"> next</span><span class="token-punctuation">)</span></div></div><div></div></code></pre></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;opacity:0.3"><div style="display:inline-block" class="cs-line cs-line-40"><span class="token-keyword">const</span><span class="token-plain"> </span><span class="token-function-variable">isGone</span><span class="token-plain"> </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-punctuation">(</span><span class="token-parameter">prev</span><span class="token-punctuation">,</span><span class="token-parameter"> next</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-operator">=&gt;</span><span class="token-plain"> </span><span class="token-parameter">key</span><span class="token-plain"> </span><span class="token-operator">=&gt;</span><span class="token-plain"> </span><span class="token-operator">!</span><span class="token-punctuation">(</span><span class="token-plain">key </span><span class="token-keyword">in</span><span class="token-plain"> next</span><span class="token-punctuation">)</span></div></div><div></div></code></pre></div></div><div style="overflow:auto;height:100%;width:100%"><div class="cs-container" style="width:100%;height:100%;max-height:100%;position:relative"><pre class="cs-content css-lx95p3" style="margin:0;height:100%;overflow:hidden"><code class="cs-scaled-content css-1i8e78v" style="display:block;height:100%;transform:scale(1);transform-origin:center 0px"><div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-12"><span class="token-punctuation">}</span></div></div><div style="overflow:hidden;height:100px;opacity:1;transform:translateX(0px)"><div style="display:inline-block" class="cs-line cs-line-40"><span class="token-keyword">const</span><span class="token-plain"> </span><span class="token-function-variable">isGone</span><span class="token-plain"> </span><span class="token-operator">=</span><span class="token-plain"> </span><span class="token-punctuation">(</span><span class="token-parameter">prev</span><span class="token-punctuation">,</span><span class="token-parameter"> next</span><span class="token-punctuation">)</span><span class="token-plain"> </span><span class="token-operator">=&gt;</span><span class="token-plain"> </span><span class="token-parameter">key</span><span class="token-plain"> </span><span class="token-operator">=&gt;</span><span class="token-plain"> </span><span class="token-operator">!</span><span class="token-punctuation">(</span><span class="token-plain">key </span><span class="token-keyword">in</span><span class="token-plain"> next</span><span class="token-punctuation">)</span></div></div><div></div></code></pre></div></div></div></div></div></div><div class="scroller css-1bezway"><div class="css-2ept1n"><div style="top:0%;bottom:0%;width:3px" class="css-8fpq54"></div><div><h3 id="step-vii-function-components" class="css-c39m66">Step VII: Function Components</h3><p class="css-1mv7wyt">The next thing we need to add is support for function components.</p><p class="css-1mv7wyt">First let’s change the example. We’ll use this simple function component, that returns an <code class="css-iofpht">h1</code> element.</p><p class="css-1mv7wyt">Note that if we transform the jsx to js, it will be:</p><div class="css-0"><pre class="language-js prism-code language-javascript css-266fzy"><div class="token-line"><span class="token keyword css-1baulvz">function</span><span class="token plain css-1baulvz"> </span><span class="token function maybe-class-name css-1baulvz">App</span><span class="token punctuation css-1baulvz">(</span><span class="token parameter css-1baulvz">props</span><span class="token punctuation css-1baulvz">)</span><span class="token plain css-1baulvz"> </span><span class="token punctuation css-1baulvz">{</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">  </span><span class="token keyword css-1baulvz">return</span><span class="token plain css-1baulvz"> </span><span class="token maybe-class-name css-1baulvz">Didact</span><span class="token punctuation css-1baulvz">.</span><span class="token method function property-access css-1baulvz">createElement</span><span class="token punctuation css-1baulvz">(</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">    </span><span class="token string css-1baulvz">&quot;h1&quot;</span><span class="token punctuation css-1baulvz">,</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">    </span><span class="token keyword null nil css-1baulvz">null</span><span class="token punctuation css-1baulvz">,</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">    </span><span class="token string css-1baulvz">&quot;Hi &quot;</span><span class="token punctuation css-1baulvz">,</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">    props</span><span class="token punctuation css-1baulvz">.</span><span class="token property-access css-1baulvz">name</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">  </span><span class="token punctuation css-1baulvz">)</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz"></span><span class="token punctuation css-1baulvz">}</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz"></span><span class="token keyword css-1baulvz">const</span><span class="token plain css-1baulvz"> element </span><span class="token operator css-1baulvz">=</span><span class="token plain css-1baulvz"> </span><span class="token maybe-class-name css-1baulvz">Didact</span><span class="token punctuation css-1baulvz">.</span><span class="token method function property-access css-1baulvz">createElement</span><span class="token punctuation css-1baulvz">(</span><span class="token maybe-class-name css-1baulvz">App</span><span class="token punctuation css-1baulvz">,</span><span class="token plain css-1baulvz"> </span><span class="token punctuation css-1baulvz">{</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz">  name</span><span class="token punctuation css-1baulvz">:</span><span class="token plain css-1baulvz"> </span><span class="token string css-1baulvz">&quot;foo&quot;</span><span class="token punctuation css-1baulvz">,</span><span class="token plain css-1baulvz"></span></div><div class="token-line"><span class="token plain css-1baulvz"></span><span class="token punctuation css-1baulvz">}</span><span class="token punctuation css-1baulvz">)</span></div></pre></div></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><p class="css-1mv7wyt">Function components are differents in two ways:</p><ul class="css-wf0k3i"><li class="css-16s26jd">the fiber from a function component doesn’t have a DOM node</li><li class="css-16s26jd">and the children come from running the function instead of getting them directly from the <code class="css-iofpht">props</code></li></ul></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><p class="css-1mv7wyt">We check if the fiber type is a function, and depending on that we go to a different update function.</p><p class="css-1mv7wyt">In <code class="css-iofpht">updateHostComponent</code> we do the same as before.</p></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><p class="css-1mv7wyt">And in <code class="css-iofpht">updateFunctionComponent</code> we run the function to get the children.</p><p class="css-1mv7wyt">For our example, here the <code class="css-iofpht">fiber.type</code> is the <code class="css-iofpht">App</code> function and when we run it, it returns the <code class="css-iofpht">h1</code> element.</p><p class="css-1mv7wyt">Then, once we have the children, the reconciliation works in the same way, we don’t need to change anything there.</p></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><p class="css-1mv7wyt">What we need to change is the <code class="css-iofpht">commitWork</code> function.</p><p class="css-1mv7wyt">Now that we have fibers without DOM nodes we need to change two things.</p></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><p class="css-1mv7wyt">First, to find the parent of a DOM node we’ll need to go up the fiber tree until we find a fiber with a DOM node.</p></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><p class="css-1mv7wyt">And when removing a node we also need to keep going until we find a child with a DOM node.</p></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><h3 id="step-viii-hooks" class="css-c39m66">Step VIII: Hooks</h3><p class="css-1mv7wyt">Last step. Now that we have function components let’s also add state.</p></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><p class="css-1mv7wyt">Let’s change our example to the classic counter component. Each time we click it, it increments the state by one.</p><p class="css-1mv7wyt">Note that we are using <code class="css-iofpht">Didact.useState</code> to get and update the counter value.</p></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><p class="css-1mv7wyt">Here is where we call the <code class="css-iofpht">Counter</code> function from the example. And inside that function we call <code class="css-iofpht">useState</code>.</p></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><p class="css-1mv7wyt">We need to initialize some global variables before calling the function component so we can use them inside of the <code class="css-iofpht">useState</code> function.</p><p class="css-1mv7wyt">First we set the work in progress fiber.</p><p class="css-1mv7wyt">We also add a <code class="css-iofpht">hooks</code> array to the fiber to support calling <code class="css-iofpht">useState</code> several times in the same component. And we keep track of the current hook index.</p></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><p class="css-1mv7wyt">When the function component calls <code class="css-iofpht">useState</code>, we check if we have an old hook. We check in the <code class="css-iofpht">alternate</code> of the fiber using the hook index.</p><p class="css-1mv7wyt">If we have an old hook, we copy the state from the old hook to the new hook,
if we don’t we initialize the state.</p><p class="css-1mv7wyt">Then we add the new hook to the fiber, increment the hook index by one, and return the state.</p></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><p class="css-1mv7wyt"><code class="css-iofpht">useState</code> should also return a function to update the state, so we define a <code class="css-iofpht">setState</code> function that receives an action (for the <code class="css-iofpht">Counter</code> example this action is the function that increments the state by one).</p><p class="css-1mv7wyt">We push that action to a queue we added to the hook.</p><p class="css-1mv7wyt">And then we do something similar to what we did in the <code class="css-iofpht">render</code> function, set a new work in progress root as the next unit of work so the work loop can start a new render phase.</p></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><p class="css-1mv7wyt">But we haven’t run the action yet.</p><p class="css-1mv7wyt">We do it the next time we are rendering the component, we get all the actions from the old hook queue, and then apply them one by one to the new hook state, so when we return the state it’s updated.</p></div></div><div class="css-2ept1n"><div style="top:0%;bottom:100%" class="css-8fpq54"></div><div><p class="css-1mv7wyt">And that’s all. We’ve built our own version of React.</p><p class="css-1mv7wyt">You can play with it on <a href="https://codesandbox.io/s/didact-8-21ost" class="css-1scict0">codesandbox</a> or <a href="https://github.com/pomber/didact" class="css-1scict0">github</a>.</p></div></div></div></div><h3 id="epilogue" class="css-c39m66">Epilogue</h3><p class="css-1mv7wyt">Besides helping you understand how React works, one of the goals of this post is to make it easier for you to dive deeper in the React codebase. That’s why we used the same variable and function names almost everywhere.</p><p class="css-1mv7wyt">For example, if you add a breakpoint in one of your function components in a real React app, the call stack should show you:</p><ul class="css-wf0k3i"><li class="css-16s26jd"><code class="css-iofpht">workLoop</code></li><li class="css-16s26jd"><code class="css-iofpht">performUnitOfWork</code></li><li class="css-16s26jd"><code class="css-iofpht">updateFunctionComponent</code></li></ul><p class="css-1mv7wyt">We didn’t include a lot of React features and optimizations. For example, these are a few things that React does differently:</p><ul class="css-wf0k3i"><li class="css-16s26jd">In Didact, we are walking the whole tree during the render phase. React instead follows some hints and heuristics to skip entire sub-trees where nothing changed.</li><li class="css-16s26jd">We are also walking the whole tree in the commit phase. React keeps a linked list with just the fibers that have effects and only visit those fibers.</li><li class="css-16s26jd">Every time we build a new work in progress tree, we create new objects for each fiber. React recycles the fibers from the previous trees.</li><li class="css-16s26jd">When Didact receives a new update during the render phase, it throws away the work in progress tree and starts again from the root. React tags each update with an expiration timestamp and uses it to decide which update has a higher priority.</li><li class="css-16s26jd">And many more…</li></ul><p class="css-1mv7wyt">There are also a few features that you can add easily:</p><ul class="css-wf0k3i"><li class="css-16s26jd">use an object for the style prop</li><li class="css-16s26jd"><a href="https://github.com/pomber/didact/issues/11" class="css-1scict0">flatten children arrays</a></li><li class="css-16s26jd">useEffect hook</li><li class="css-16s26jd">reconciliation by key</li></ul><p class="css-1mv7wyt">If you add any of these or other features to Didact send a pull request to the <a href="https://github.com/pomber/didact" class="css-1scict0">GitHub repo</a>, so others can see it.</p><p class="css-1mv7wyt">Thanks for reading!</p><p class="css-1mv7wyt">And if you want to comment, like or share this post you can use this tweet:</p><undefined><style data-emotion-css="1dahk1j">.css-1dahk1j{padding:0;margin:0;margin-bottom:28px;margin-left:28px;margin-right:28px;color:inherit;border-left-color:inherit;opacity:0.8;}.css-1dahk1j.translation{font-size:1em;}</style><blockquote class="twitter-tweet css-1dahk1j" data-dnt="true"><p lang="en" dir="ltr" class="css-1mv7wyt">Had to build a new blog and some tools to be able to publish this post with the format I wanted. It took some time but it&#x27;s finally ready!<br/><br/>📢 the updated DIY guide to build React from scratch<br/>✨ <a href="https://t.co/RfGrl8ARYz" class="css-1scict0">https://t.co/RfGrl8ARYz</a> <a href="https://t.co/3kih0xLHIu" class="css-1scict0">pic.twitter.com/3kih0xLHIu</a></p>— Rodrigo Pombo (@pomber) <a href="https://twitter.com/pomber/status/1194616086941126656?ref_src=twsrc%5Etfw" class="css-1scict0">November 13, 2019</a></blockquote></undefined></main></main></div></div></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/build-your-own-react/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-3a9f397a1682eeb031a5.js"],"component---src-templates-post-js":["/component---src-templates-post-js-914a311e412eac3f8658.js"],"component---src-pages-card-with-image-js":["/component---src-pages-card-with-image-js-f62667ebc2fbcd9149a9.js"],"component---src-pages-card-js":["/component---src-pages-card-js-2a9e2d71ce8a35d54932.js"],"component---src-pages-index-js":["/component---src-pages-index-js-db40cafdfdaf3c17fc96.js"]};/*]]>*/</script><script src="/component---src-templates-post-js-914a311e412eac3f8658.js" async=""></script><script src="/commons-905574fadf973c38b312.js" async=""></script><script src="/app-3a9f397a1682eeb031a5.js" async=""></script><script src="/styles-47650936bd9d421e990d.js" async=""></script><script src="/webpack-runtime-73554bd2e193becfd1eb.js" async=""></script></body></html>